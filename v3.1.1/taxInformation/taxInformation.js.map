{"version":3,"sources":["../../../../src/taxInformation/taxInformation.es6"],"names":["win","events","on","data","is_mf","test","local_storage","get","id","send","then","get_account_status","status","moveToTop","Promise","all","residence_list","createBlankWindow","i18n","title","width","height","resizable","collapsable","minimizable","maximizable","closable","closeOnEscape","modal","ignoreTileAction","close","dialog","state","empty_fields","show","validate","clear","_","debounce","place_of_birth","value","tax_residence","tax_identification_number","country_array","submit_disabled","cancel","invalidate","submit","isValid","request","get_settings","address_line_1","address_city","phone","set_settings","join","growl","notice","message","catch","err","console","log","error","msg","bind"],"mappings":"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","file":"taxInformation.js","sourcesContent":["import 'css!taxInformation/taxInformation.css';\r\nimport rv from 'common/rivetsExtra';\r\nimport $ from 'jquery';\r\nimport windows from 'windows/windows';\r\nimport $html from 'text!./taxInformation.html';\r\nimport liveapi from 'websockets/binary_websockets';\r\nimport 'common/util';\r\nimport 'jquery-growl'\r\nlet win = null;\r\nliveapi.events.on(\"login\", (data) => {\r\n    const is_mf = /MF/gi.test(local_storage.get('oauth')[0].id);\r\n    if (is_mf)\r\n        liveapi.send({ \"get_account_status\": 1 }).then((data) => {\r\n            if (!/crs_tin_information/.test(data.get_account_status.status)) {\r\n                if (win) {\r\n                    win.moveToTop();\r\n                    return;\r\n                }\r\n                Promise.all([liveapi.send({ \"get_settings\": 1 }), liveapi.send({ residence_list: 1 })]).then((data) => {\r\n                    win = windows.createBlankWindow($($html).i18n(), {\r\n                        title: \"Tax Information\".i18n(),\r\n                        width: 700,\r\n                        height: 'auto',\r\n                        resizable: false,\r\n                        collapsable: false,\r\n                        minimizable: false,\r\n                        maximizable: false,\r\n                        closable: false,\r\n                        closeOnEscape: false,\r\n                        modal: true,\r\n                        ignoreTileAction: true,\r\n                        close: () => {\r\n                            win.dialog('destroy');\r\n                            win = null\r\n                        }\r\n                    });\r\n                    const state = {\r\n                        empty_fields: {\r\n                            show: () => {\r\n                                state.empty_fields.validate = true;\r\n                                state.empty_fields.clear();\r\n                            },\r\n                            clear: _.debounce(function() {\r\n                                state.empty_fields.validate = false;\r\n                            }, 4000),\r\n                            validate: false\r\n                        },\r\n                        place_of_birth: data[1].residence_list[0].value,\r\n                        tax_residence: '',\r\n                        tax_identification_number: null,\r\n                        country_array: data[1].residence_list,\r\n                        submit_disabled: false,\r\n                        cancel: () => {\r\n                            liveapi.invalidate();\r\n                            win.dialog('close');\r\n                        },\r\n                        submit: () => {\r\n                            if (!state.isValid()) {\r\n                                state.empty_fields.show();\r\n                                return;\r\n                            }\r\n                            state.submit_disabled = true;\r\n                            const request = data[0].get_settings;\r\n\r\n                            liveapi.send({\r\n                                address_line_1: request.address_line_1,\r\n                                address_city: request.address_city,\r\n                                phone: request.phone,\r\n                                place_of_birth: state.place_of_birth,\r\n                                set_settings: 1,\r\n                                tax_identification_number: state.tax_identification_number,\r\n                                tax_residence: state.tax_residence.join(\",\")\r\n                            }).then(() => {\r\n                                $.growl.notice({ message: \"Tax Information successfully updated\".i18n() });\r\n                                win.dialog(\"close\");\r\n                            }).catch((err) => {\r\n                                console.log(err);\r\n                                $.growl.error({ message: err.msg })\r\n                            })\r\n                        },\r\n                        isValid: () => {\r\n                            return state.place_of_birth && state.tax_residence && state.tax_identification_number &&\r\n                                /^[\\w-]{0,20}$/.test(state.tax_identification_number)\r\n                        }\r\n                    }\r\n                    rv.bind(win, state);\r\n                    win.dialog(\"open\");\r\n                });\r\n            }\r\n        }).catch((err) => {\r\n            console.log(err);\r\n            $.growl.error({ message: err.msg })\r\n        });\r\n});\r\n"]}