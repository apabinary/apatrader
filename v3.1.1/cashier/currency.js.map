{"version":3,"sources":["../../../../src/cashier/currency.es6"],"names":["require","check_promise","check_currency_async","Promise","resolve","reject","$html","win","createBlankWindow","dialogClass","width","height","resizable","collapsable","minimizable","maximizable","modal","ignoreTileAction","close","dialog","remove","destroy","win_view","unbind","state","disabled","value","array","continue","send","set_account_currency","then","local_storage","set","balance","subscribe","catch","err","console","error","cancel","message","i18n","cached","payout_currencies","data","bind","check_currency","up"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAMAA,UAAQ,CAAC,aAAD,CAAR;;AAEA,MAAIC,gBAAgB,IAApB;AACA,MAAMC,uBAAuB,SAAvBA,oBAAuB;AAAA,WAAM,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAChE,UAAIC,QAAQ,yCAAZ;AACA,UAAIC,MAAM,kBAAQC,iBAAR,CAA0BF,KAA1B,EAAiC;AACvCG,qBAAa,gBAD0B;AAEvCC,eAAO,GAFgC;AAGvCC,gBAAQ,GAH+B;AAIvCC,mBAAW,KAJ4B;AAKvCC,qBAAa,KAL0B;AAMvCC,qBAAa,KAN0B;AAOvCC,qBAAa,KAP0B;AAQvCC,eAAO,IARgC;AASvCC,0BAAiB,IATsB;AAUvCC,eAAO,iBAAM;AACXX,cAAIY,MAAJ,CAAW,SAAX;AACAZ,cAAIa,MAAJ;AACAb,gBAAM,IAAN;AACD,SAdsC;AAevCc,iBAAS,mBAAM;AACbC,sBAAYA,SAASC,MAAT,EAAZ;AACAD,qBAAW,IAAX;AACD;AAlBsC,OAAjC,CAAV;;AAqBA,UAAIE,QAAQ;AACVC,kBAAU,IADA;AAEVC,eAAO,gBAFG;AAGVC,eAAO,CAAC,gBAAD,CAHG;AAIVC,kBAAU,qBAAM;AACdJ,gBAAMC,QAAN,GAAiB,IAAjB;AACA,sCAAQI,IAAR,CAAa,EAAEC,sBAAsBN,MAAME,KAA9B,EAAb,EACGK,IADH,CACQ3B,OADR,EACiBC,MADjB,EAEG0B,IAFH,CAEQ,YAAM;AACVC,0BAAcC,GAAd,CAAkB,UAAlB,EAA8BT,MAAME,KAApC;AACA;AACA,wCAAQG,IAAR,CAAa,EAACK,SAAS,CAAV,EAAaC,WAAU,CAAvB,EAAb,EACCC,KADD,CACO,UAASC,GAAT,EAAa;AAAEC,sBAAQC,KAAR,CAAcF,GAAd;AAAqB,aAD3C;AAEA9B,gBAAIY,MAAJ,CAAW,OAAX;AACD,WARH;AASD,SAfS;AAgBVqB,gBAAQ,kBAAM;AACZjC,cAAIY,MAAJ,CAAW,OAAX;AACAd,iBAAO,EAAEoC,SAAS,uBAAuBC,IAAvB,EAAX,EAAP;AACD;AAnBS,OAAZ;;AAsBA,kCAAQC,MAAR,CAAed,IAAf,CAAoB,EAACe,mBAAkB,CAAnB,EAApB,EAA2Cb,IAA3C,CAAgD,UAACc,IAAD,EAAU;AACxDrB,cAAMC,QAAN,GAAiB,KAAjB;AACAD,cAAMG,KAAN,GAAckB,KAAKD,iBAAnB;AACApB,cAAME,KAAN,GAAcmB,KAAKD,iBAAL,CAAuB,CAAvB,CAAd;AACD,OAJD,EAIGR,KAJH,CAIS;AAAA,eAAK/B,OAAO,EAACoC,SAAS,sCAAsCC,IAAtC,EAAV,EAAP,CAAL;AAAA,OAJT;;AAMA,UAAIpB,WAAW,sBAAGwB,IAAH,CAAQxC,MAAM,CAAN,CAAR,EAAkBkB,KAAlB,CAAf;AACAjB,UAAIY,MAAJ,CAAW,MAAX;AACH,KArDkC,CAAN;AAAA,GAA7B;;AAuDO,MAAM4B,0CAAiB,SAAjBA,cAAiB,GAAM;AAClC,QAAG9C,aAAH,EAAkB;AAAE,aAAOA,aAAP;AAAuB;AAC3CA,oBAAgBC,uBAAuB6B,IAAvB,CAA4B;AAAA,aAAK9B,gBAAgB,IAArB;AAAA,KAA5B,EAAuDmC,KAAvD,CAA6D,cAAM;AACjFnC,sBAAgB,IAAhB;AACA,YAAM+C,EAAN;AACD,KAHe,CAAhB;AAIA,WAAO/C,aAAP;AACD,GAPM;;oBASQ;AACb8C;AADa,G","file":"currency.js","sourcesContent":["import $ from 'jquery';\r\nimport liveapi from 'websockets/binary_websockets';\r\nimport windows from 'windows/windows';\r\nimport rv from 'common/rivetsExtra';\r\nimport html from 'text!cashier/currency.html';\r\n\r\nrequire(['common/util']);\r\n\r\nlet check_promise = null;\r\nconst check_currency_async = () => new Promise((resolve, reject) => {\r\n    var $html = $(html);\r\n    var win = windows.createBlankWindow($html, {\r\n        dialogClass: \"dialog-confirm\",\r\n        width: 500,\r\n        height: 230,\r\n        resizable: false,\r\n        collapsable: false,\r\n        minimizable: false,\r\n        maximizable: false,\r\n        modal: true,\r\n        ignoreTileAction:true,\r\n        close: () => {\r\n          win.dialog('destroy');\r\n          win.remove();\r\n          win = null;\r\n        },\r\n        destroy: () => {\r\n          win_view && win_view.unbind();\r\n          win_view = null;\r\n        }\r\n    });\r\n\r\n    var state = {\r\n      disabled: true,\r\n      value: 'Select a value',\r\n      array: ['Select a value'],\r\n      continue: () => {\r\n        state.disabled = true;\r\n        liveapi.send({ set_account_currency: state.value })\r\n          .then(resolve, reject)\r\n          .then(() => {\r\n            local_storage.set(\"currency\", state.value);\r\n            //For updating balance in navigation\r\n            liveapi.send({balance: 1, subscribe:1})\r\n            .catch(function(err){ console.error(err); });\r\n            win.dialog('close');\r\n          });\r\n      },\r\n      cancel: () => {\r\n        win.dialog('close');\r\n        reject({ message: 'Please set currency.'.i18n() });\r\n      }\r\n    };\r\n\r\n    liveapi.cached.send({payout_currencies:1}).then((data) => {\r\n      state.disabled = false;\r\n      state.array = data.payout_currencies;\r\n      state.value = data.payout_currencies[0];\r\n    }).catch(()=> reject({message: 'Please try again after few minutes.'.i18n()}));\r\n\r\n    var win_view = rv.bind($html[0], state);\r\n    win.dialog('open');\r\n});\r\n\r\nexport const check_currency = () => {\r\n  if(check_promise) { return check_promise; }\r\n  check_promise = check_currency_async().then(()=> check_promise = null).catch(up => {\r\n    check_promise = null;\r\n    throw up;\r\n  });\r\n  return check_promise;\r\n}\r\n\r\nexport default {\r\n  check_currency\r\n}\r\n"]}