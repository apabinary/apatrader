define(["exports","jquery","websockets/binary_websockets","windows/windows","cashier/currency","common/rivetsExtra","lodash","moment","cashier/uk_funds_protection","text!cashier/deposit.html","shownotice/shownotice"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){return a&&a.__esModule?a:{"default":a}}function m(a){a.click(function(){y?y.moveToTop():Promise.all([q["default"].cached.authorize(),x["default"].init("deposit")]).then(function(a){return a[0].authorize.currency&&local_storage.get("currency")?!0:s["default"].check_currency()}).then(function(){n(w["default"])})["catch"](A)})}function n(a){a=p["default"](a).i18n(),y=r["default"].createBlankWindow(a,{title:"Deposit funds",resizable:!0,collapsable:!1,minimizable:!0,maximizable:!0,width:700,height:600,"data-authorized":!0,close:function(){y.dialog("destroy"),y.trigger("dialogclose"),y.remove(),y=null},open:function(){},destroy:function(){z&&z.unbind(),z=null}}),o(a),y.dialog("open");var b=y.dialog("widget").offset();b.top=110,y.dialog("option","position",{my:b.left,at:b.top}),y.dialog("widget").css({left:b.left+"px",top:b.top+"px"}),y.fixFooterPosition(),y.track({module_id:"deposit",is_unique:!0})}function o(a){var b=(q["default"].app_id,{route:{value:"standard-methods"},empty_fields:{validate:!1,clear:u["default"].debounce(function(){b.empty_fields.validate=!1},4e3),show:function(){b.empty_fields.validate=!0,b.empty_fields.clear()}},user:{email:local_storage.get("authorize").email,cashier_url:"",residence:"",residence_name:""},standard_methods:{iframe_visible:!1},payment_agents:{list:[],current:{}}});b.route.update=function(a){b.route.value=a},b.standard_methods.iframe_loaded=function(){b.user.cashier_url&&(b.standard_methods.iframe_visible=!0)},b.payment_agents.get_commission_text=function(a){return a.deposit_commission===a.withdrawal_commission?a.deposit_commission+"% "+"commission".i18n():a.deposit_commission+"% "+"deposits".i18n()+" / "+a.withdrawal_commission+"% "+"withdrawals".i18n()},b.payment_agents.onclick=function(a,c){var d=p["default"](c.target).next(),e=b.payment_agents.elem;e&&e.css("max-height","0"),b.payment_agents.current.is_active=!1,b.payment_agents.current===a?b.payment_agents.current={}:(b.payment_agents.current=a,b.payment_agents.elem=d,d.css("max-height",d[0].scrollHeight+"px"),a.is_active=!0)},z=t["default"].bind(a[0],b),q["default"].send({cashier:"deposit"}).then(function(a){b.user.cashier_url=a.cashier})["catch"](function(a){return"ASK_UK_FUNDS_PROTECTION"===a.code?(y.dialog("close"),void v["default"].init_win().then(function(){n(w["default"])})["catch"](function(a){A(a)})):void(b.error_text=a.message)});var c=q["default"].send({get_settings:1}).then(function(a){b.user.residence=a.get_settings.country_code,b.user.residence_name=a.get_settings.country})["catch"](A);c.then(function(){return b.user.residence?q["default"].send({paymentagent_list:b.user.residence}):{paymentagent_list:{list:[]}}}).then(function(a){var c=a.paymentagent_list.list.map(function(a){return a.commission_text=b.payment_agents.get_commission_text(a),a.supported_banks=a.supported_banks.toLowerCase().split(","),a});b.payment_agents.list=c})["catch"](A)}Object.defineProperty(a,"__esModule",{value:!0}),a.init=m;var p=l(b),q=l(c),r=l(d),s=l(e),t=l(f),u=l(g),v=(l(h),l(i)),w=l(j),x=l(k);require(["text!cashier/deposit.html"]),require(["css!cashier/deposit.css"]);var y=null,z=null,A=function(a){p["default"].growl.error({message:a.message})};a["default"]={init:m}});