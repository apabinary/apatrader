{"version":3,"sources":["../../../../src/trade/tradeDialog.es6"],"names":["init","require","replacer","field_name","value","obj","debounce","formatters","apply_fixes","available","filter","each","sortBy","row","rank","contract_category_display","contract_display","trading_times_for","yyyy_mm_dd","symbol","cached","send","trading_times","then","data","times","open","close","markets","forEach","market","submarkets","sub","symbols","sym","catch","err","console","error","get_current_template","state","name","template","categories_value","categories","categoriy_displays_selected","category_displays","selected","date_start_value","date_start","digits_value","digits","duration_value","duration","duration_count_value","duration_count","duration_unit_value","duration_unit","expiry_value_hour","date_expiry","value_hour","expiry_value_date","value_date","expiry_value","barriers_barrier_count","barriers","barrier_count","barriers_barrier","barrier","barriers_high_barrier","high_barrier","barriers_low_barrier","low_barrier","basis_value","basis","currency_value","currency","basis_amount","amount","spreads_amount_per_point","spreads","amount_per_point","spreads_stop_type","stop_type","spreads_stop_loss","stop_loss","spreads_stop_profit","stop_profit","set_current_template","tpl","warn","msg","growl","warning","message","i18n","includes","array","defer","visible","some","is_today","utc","isAfter","init_state","root","dialog","contracts_for_spot","ranges","min","max","text","format","today_times","disabled","onHourShow","hour","now","close_hour","open_hour","onMinuteShow","minute","close_minute","open_minute","paddingTop","paddings","perv_barrier","was_perv_barrier_daily","perv_high_barrier","was_perv_high_barrier_daily","perv_low_barrier","was_perv_low_barrier_daily","barrier_live","tick","quote","high_barrier_live","low_barrier_live","limit","find","spread","spot","spot_time","deposit_","epoch","perv_quote","down","ans","ticks","loading","proposal","symbol_name","display_name","last_promise","id","ask_price","display_value","payout","netprofit_","formatPrice","toFixed","return_","ret","purchase","tooltips","my","at","collision","barrier_p","openHelp","notice","showSpecificContent","update_currency","is_authenticated","payout_currencies","hide","e","target","closest","length","toggle","update_times","expiry","range","head","add","update","map","uniq","onclick","attr","forward_starting_options","spot_starting_options","assign","model","later","Date","getTime","step","from","Math","ceil","d","getUTCHours","slice","getUTCMinutes","getUTCDay","push","options","date_or_hour","unix","onchange","category","start_type","durations","r","min_contract_duration","max_contract_duration","type","expiry_type","daily","replace","min_unit","last","max_unit","sort_dict","sort","r1","r2","try_to_keep_value","subcat","matches","differs","under","over","unit","update_barrier","new_barrier","sign","is_daily","def_barrier","test","result","update_limit","payout_limit","request","subscribe","contract_type","barrier2","forget","new_proposal_promise","echo_req","details","longcode","update_track","get_template","show","div","appendTo","css","left","remove","extra","category_display","pip","show_tick_chart","tick_count","tradeConf","buy","price","contract_id","transaction_id","proposal_open_contract","code","invalidate","tick_stream_alive","events","on","shift","contracts_for","saved_template","isTrackerInitiated","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","relativePosition","unregister","key","view","unbind","destroy","track","module_id","is_unique","keyFor","has_digits","register","granularity","count","style","delay","bind","undefined","set_template","hide_template_menu","tradeTemplateManager"],"mappings":"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","file":"tradeDialog.js","sourcesContent":["/**\r\n * Created by amin on November 18, 2015.\r\n */\r\n\r\n/* init(...) parameters => The symbol is in the following format:\r\n     symbol = {\r\n        symbol: \"frxXAUUSD\",\r\n        display_name: \"Gold/USD\",\r\n        delay_amount: 0,\r\n        settlement: \"\",\r\n        feed_license: \"realtime\",\r\n        events: [{ dates: \"Fridays\", descrip: \"Closes early (at 21:00)\" }, { dates: \"2015-11-26\", descrip: \"Closes early (at 18:00)\" }],\r\n        times: { open: [\"00:00:00\"], close: [\"23:59:59\"], settlement: \"23:59:59\" },\r\n        pip: \"0.001\"\r\n      },\r\n\r\n  The contracts_for is in the following format:\r\n    contracts_for = {\r\n        open: 1447801200,\r\n        close: 1447822800,\r\n        hit_count: 14,\r\n        spot: \"5137.20\",\r\n        available: [\r\n            {\r\n                market: \"indices\",                  contract_display: \"higher\",\r\n                min_contract_duration: \"1d\",        max_contract_duration: \"365d\",\r\n                barriers: 0,                        sentiment: \"up\",\r\n                barrier_category: \"euro_atm\",       start_type: \"spot\",\r\n                contract_category: \"callput\",       submarket: \"asia_oceania\",\r\n                exchange_name: \"ASX\",               expiry_type: \"daily\",\r\n                underlying_symbol: \"AS51\",          contract_category_display: \"Up/Down\",\r\n                contract_type: \"CALL\"\r\n            }]\r\n    }\r\n*/\r\n\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport moment from 'moment';\r\nimport windows from 'windows/windows';\r\nimport rv from 'common/rivetsExtra';\r\nimport liveapi from 'websockets/binary_websockets';\r\nimport chartingRequestMap from 'charts/chartingRequestMap';\r\nimport html from 'text!trade/tradeDialog.html';\r\nimport 'css!trade/tradeDialog.css';\r\nimport 'timepicker';\r\nimport 'jquery-ui';\r\nimport 'common/util';\r\nimport help from 'help/help';\r\n\r\nrequire(['trade/tradeConf']); /* trigger async loading of trade Confirmation */\r\nvar replacer = function (field_name, value) { return function (obj) { obj[field_name] = value; return obj; }; };\r\nvar debounce = rv.formatters.debounce;\r\n\r\nfunction apply_fixes(available){\r\n    /* fix for server side api, not seperating higher/lower frim rise/fall in up/down category */\r\n\r\n    _(available).filter({\r\n      'contract_category_display': 'Up/Down',\r\n      'barrier_category' : 'euro_atm',\r\n      'contract_display' : 'higher'\r\n    }).each(replacer('contract_display', 'rise'));\r\n\r\n    _(available).filter({\r\n      'contract_category_display':'Up/Down',\r\n      'barrier_category': 'euro_atm',\r\n      'contract_display': 'lower',\r\n    }).each(replacer('contract_display','fall'));\r\n    /* fix for server side api, returning two different contract_category_displays for In/Out */\r\n    _(available).filter(['contract_category_display', 'Stays In/Goes Out'])\r\n                .each(replacer('contract_category_display', 'In/Out'));\r\n    _(available).filter(['contract_category_display', 'Ends In/Out'])\r\n                .each(replacer('contract_category_display', 'In/Out'));\r\n    /* fix for websocket having a useless barrier value for digits */\r\n    _(available).filter(['contract_category_display', 'Digits'])\r\n                .each(replacer('barriers', 0));\r\n    /* fix for contract_display text in In/Out menue */\r\n    _(available).filter(['contract_display', 'ends outside']).each(replacer('contract_display', 'ends out'));\r\n    _(available).filter(['contract_display', 'ends between']).each(replacer('contract_display', 'ends in'));\r\n    _(available).filter(['contract_display', 'stays between']).each(replacer('contract_display', 'stays in'));\r\n    _(available).filter(['contract_display', 'goes outside']).each(replacer('contract_display', 'goes out'));\r\n    _(available).filter(['contract_display', 'touches']).each(replacer('contract_display', 'touch'));\r\n    _(available).filter(['contract_display', 'does not touch']).each(replacer('contract_display', 'no touch'));\r\n\r\n    /* sort the items in the array according to the way we want to show them */\r\n    available = _.sortBy(available,function(row){\r\n      var rank = { 'Up/Down': 1, 'Touch/No Touch':2, 'In/Out': 3, 'Digits': 4, 'Asians': 5, 'Spreads': 6 }[row.contract_category_display];\r\n      if(rank === 4) { /* Digits */\r\n        rank = {'odd': 4, 'even' : 4.5}[row.contract_display] || 3.5;\r\n      }\r\n      return rank\r\n    });\r\n\r\n    return available;\r\n}\r\n\r\n/* get open and close time for a symbol trading_times */\r\nfunction trading_times_for(yyyy_mm_dd, symbol) {\r\n    return liveapi.cached\r\n           .send({trading_times: yyyy_mm_dd})\r\n           .then(function(data){\r\n              var times = { open : '--', close: '--'};\r\n              data.trading_times.markets.forEach(function(market){\r\n                  market.submarkets.forEach(function(sub){\r\n                    sub.symbols.forEach(function(sym){\r\n                      if(sym.symbol === symbol) {\r\n                        times = {open: sym.times.open[0], close: sym.times.close[0]};\r\n                      }\r\n                    });\r\n                  });\r\n              });\r\n              return times;\r\n           })\r\n           .catch(function(err){\r\n             console.error(err);\r\n             return { open : '--', close: '--'};\r\n           });\r\n}\r\n\r\n/* return the current state of dialog as a template */\r\nfunction get_current_template(state) {\r\n  return {\r\n    name: state.template.name,\r\n    categories_value: state.categories.value,\r\n    categoriy_displays_selected: state.category_displays.selected,\r\n    date_start_value: state.date_start.value,\r\n    digits_value: state.digits.value,\r\n    duration_value: state.duration.value,\r\n    duration_count_value: state.duration_count.value,\r\n    duration_unit_value: state.duration_unit.value,\r\n    expiry_value_hour: state.date_expiry.value_hour,\r\n    expiry_value_date: state.date_expiry.value_date,\r\n    expiry_value: state.date_expiry.value,\r\n    barriers_barrier_count: state.barriers.barrier_count,\r\n    barriers_barrier: state.barriers.barrier,\r\n    barriers_high_barrier: state.barriers.high_barrier,\r\n    barriers_low_barrier: state.barriers.low_barrier,\r\n    basis_value: state.basis.value,\r\n    currency_value: state.currency.value,\r\n    basis_amount: state.basis.amount,\r\n    spreads_amount_per_point: state.spreads.amount_per_point,\r\n    spreads_stop_type: state.spreads.stop_type,\r\n    spreads_stop_loss: state.spreads.stop_loss,\r\n    spreads_stop_profit: state.spreads.stop_profit\r\n  };\r\n};\r\n\r\nfunction set_current_template(state, tpl) {\r\n  state.template.name = tpl.name;\r\n  var warn = function(msg) { $.growl.warning({ message: msg || 'Template applied partially.'.i18n() }); }\r\n  if(!_.includes(state.categories.array, tpl.categories_value)) {\r\n    $.growl.error({ message: msg || 'Template is not applicable.'.i18n() });\r\n    return;\r\n  }\r\n  state.categories.value = tpl.categories_value;\r\n  _.defer(function() {\r\n    if(!_.includes(state.category_displays.array, tpl.categoriy_displays_selected)) {\r\n      warn();\r\n      return;\r\n    }\r\n    state.category_displays.selected = tpl.categoriy_displays_selected;\r\n    _.defer(function() {\r\n      if(state.date_start.visible) {\r\n        _.defer(function() {\r\n          if(tpl.date_start_value !== 'now' && _.some(state.date_start.array, {value: tpl.date_start_value*1}))\r\n            state.date_start.value = tpl.date_start_value*1;\r\n          else\r\n            state.date_start.value = 'now';\r\n        });\r\n      }\r\n      if(state.digits.visible) {\r\n        state.digits.value = tpl.digits_value;\r\n      }\r\n      if(state.categories.value !== 'Spreads') { /* <----- duration */\r\n        state.duration.value = tpl.duration_value;\r\n        if(state.duration.value === 'Duration' ) {\r\n          _.defer(function() {\r\n            state.duration_unit.value = tpl.duration_unit_value;\r\n            _.defer(function() {\r\n              state.duration_count.value = tpl.duration_count_value;\r\n            });\r\n          });\r\n        }\r\n        if(state.duration.value === 'End Time') {\r\n          _.defer(function() {\r\n              state.date_expiry.value_date = tpl.expiry_value_date;\r\n              var is_today = !moment.utc(state.date_expiry.value_date).isAfter(moment.utc(),'day');\r\n              if(is_today) {\r\n                _.defer(function() {\r\n                  state.date_expiry.value_hour = tpl.expiry_value_hour;\r\n                });\r\n              }\r\n          });\r\n        }\r\n      } /* <---- duration */\r\n\r\n      state.barriers.barrier_count = tpl.barriers_barrier_count;\r\n      if(state.barriers.barrier_count === 1) {\r\n        _.defer(function() {\r\n          state.barriers.barrier = tpl.barriers_barrier;\r\n        });\r\n      }\r\n      if(state.barriers.barrier_count === 2) {\r\n        _.defer(function() {\r\n          state.barriers.high_barrier = tpl.barriers_high_barrier;\r\n          state.barriers.low_barrier = tpl.barriers_low_barrier;\r\n        });\r\n      }\r\n      /* <---- barriers */\r\n\r\n      if(state.categories.value !== 'Spreads') {\r\n        _.defer(function() {\r\n          state.basis.value = tpl.basis_value;\r\n          state.currency.value = tpl.currency_value;\r\n          state.basis.amount = tpl.basis_amount;\r\n        });\r\n      } /* <----- basis, currency */\r\n\r\n      if(state.categories.value === 'Spreads') {\r\n          state.currency.value = tpl.currency_value;\r\n          state.spreads.amount_per_point = tpl.spreads_amount_per_point;\r\n          state.spreads.stop_type = tpl.spreads_stop_type;\r\n          state.spreads.stop_loss = tpl.spreads_stop_loss;\r\n          state.spreads.stop_profit = tpl.spreads_stop_profit;\r\n\r\n      } /* <---- Spreads */\r\n    });\r\n  })\r\n}\r\n\r\nfunction init_state(available,root, dialog, symbol, contracts_for_spot){\r\n\r\n  var state = {\r\n    duration: {\r\n      array: ['Duration', 'End Time'],\r\n      value: 'Duration',\r\n    },\r\n    duration_unit: {\r\n      array: [''],\r\n      ranges: [{min: 1, max:365}],\r\n      value: '',\r\n    },\r\n    duration_count: {\r\n      value: 1,\r\n      min: 1,\r\n      max: 365\r\n    },\r\n    date_start: {\r\n      value: 'now', /* epoch value if selected */\r\n      array: [{ text: 'Now', value: 'now' } ],\r\n      visible: false,\r\n    },\r\n    date_expiry: {\r\n      value_date: moment.utc().format('YYYY-MM-DD'), /* today utc in yyyy-mm-dd format */\r\n      value_hour: moment.utc().format('HH:mm'), /* now utc in hh:mm format */\r\n      value: 0,    /* epoch value of date+hour */\r\n      today_times: { open: '--', close: '--', disabled: false }, /* trading times for today */\r\n      onHourShow: function(hour) { /* for timepicker */\r\n        var times = state.date_expiry.today_times;\r\n        if(times.open === '--') return true;\r\n        var now = moment.utc();\r\n        var close_hour = moment(times.close, \"HH:mm:ss\").hour();\r\n        var open_hour = moment(times.open, \"HH:mm:ss\").hour();\r\n        if(now.hour() >= open_hour && now.hour() <= close_hour ) { open_hour =  now.hour(); }\r\n        return (hour >= open_hour && hour <= close_hour) ||\r\n               (hour <= close_hour && close_hour <= open_hour) ||\r\n               (hour >= open_hour && open_hour >= close_hour);\r\n      },\r\n      onMinuteShow: function(hour,minute){\r\n        var times = state.date_expiry.today_times;\r\n        if(times.open === '--') return true;\r\n        var now = moment.utc();\r\n        var close_hour = moment(times.close, \"HH:mm:ss\").hour(),\r\n            close_minute = moment(times.close, \"HH:mm:ss\").minute();\r\n        var open_hour = moment(times.open, \"HH:mm:ss\").hour(),\r\n            open_minute = moment(times.open, \"HH:mm:ss\").minute();\r\n        if(now.hour() >= open_hour && now.hour() <= close_hour ) {\r\n          open_hour =  now.hour();\r\n          open_minute = now.minute();\r\n        }\r\n        if(open_hour === hour) return minute >= open_minute;\r\n        if(close_hour === hour) return minute <= close_minute;\r\n        return (hour > open_hour && hour < close_hour) || hour < close_hour || hour > open_hour;\r\n      }\r\n    },\r\n    categories: {\r\n      array: [],\r\n      value: '',\r\n      paddingTop: function(){\r\n        var paddings = { \"Asians\" : '26px', \"Up/Down\" : '8px', \"Digits\" : '14px', \"In/Out\" : '4px', \"Touch/No Touch\" : '12px' , \"Spreads\":'5px' };\r\n        return paddings[state.categories.value] || '3px';\r\n      }\r\n    },\r\n    category_displays: {\r\n      array: [],\r\n      selected: ''\r\n    },\r\n    barriers: {\r\n      barrier_count: 0,\r\n      barrier : '',\r\n      perv_barrier: '', // previous barrier value for intraday and tick contracts.\r\n      was_perv_barrier_daily: false, // was the perv barrier a daily one?\r\n      high_barrier: '',\r\n      perv_high_barrier: '',\r\n      was_perv_high_barrier_daily: false,\r\n      low_barrier: '',\r\n      perv_low_barrier: '',\r\n      was_perv_low_barrier_daily: false,\r\n      barrier_live: function() { return this.barrier * 1 + state.tick.quote * 1; },\r\n      high_barrier_live: function() { return this.high_barrier * 1 + state.tick.quote * 1; },\r\n      low_barrier_live: function() { return this.low_barrier * 1 + state.tick.quote * 1; },\r\n    },\r\n    digits: {\r\n      array: ['0', '1','2','3','4','5','6','7','8','9'],\r\n      value: '0',\r\n      visible: false,\r\n      text: 'Last Digit Prediction'.i18n()\r\n    },\r\n    currency: {\r\n      array: ['USD'],\r\n      value: 'USD',\r\n    },\r\n    basis: {\r\n      array: ['Payout', 'Stake'],\r\n      value: 'payout',\r\n      amount: 10,\r\n      limit: null,\r\n    },\r\n    spreads: {\r\n      amount_per_point: 1,\r\n      stop_type: 'point', /* could be 'point' or 'dollar' */\r\n      stop_loss: (_.find(available, 'stop_loss') || { stop_loss: 10}).stop_loss,\r\n      stop_profit: (_.find(available, 'stop_profit') || { stop_profit: 10}).stop_profit,\r\n      /* updated from #proposal websocket api */\r\n      spread: 0.0,\r\n      spot: '0.0',\r\n      spot_time: '0',\r\n      deposit_: function(){\r\n        if(this.stop_type === 'point')\r\n          return this.stop_loss * this.amount_per_point;\r\n        else // 'dollar'\r\n          return this.stop_loss;\r\n      }\r\n    },\r\n    tick: {\r\n      epoch: '0',\r\n      quote: contracts_for_spot,\r\n      perv_quote: '0',\r\n      down: function(){\r\n        var ans= this.quote*1 < this.perv_quote*1;\r\n        return ans;\r\n      }\r\n    },\r\n    ticks: {\r\n      array: [], /* ticks for sparkline chart */\r\n      loading: true,\r\n    },\r\n    proposal: {\r\n      symbol: symbol.symbol,\r\n      symbol_name: symbol.display_name,\r\n      last_promise: null,\r\n      id: '', /* id of last proposal request sent */\r\n      ask_price: \"0.0\",\r\n      date_start: 0,\r\n      display_value: \"0.0\",\r\n      message: 'Loading ...'.i18n(), /* longcode */\r\n      payout: 0,\r\n      spot: \"0.0\",\r\n      spot_time: \"0\",\r\n      error: '',\r\n      loading: true, /* the proposal request state */\r\n\r\n      /* computed properties */\r\n      netprofit_: function () {\r\n        return formatPrice(((this.payout - this.ask_price) || 0).toFixed(2), state.currency.value);\r\n      },\r\n      return_: function () {\r\n        var ret = (((this.payout - this.ask_price) / this.ask_price) * 100);\r\n        ret = (ret && ret.toFixed(1)) || 0;\r\n        return ret + '%';\r\n      }\r\n    },\r\n    purchase: {\r\n      loading: false, /* is the purchased button clicked and confirmation dialog is loading */\r\n    },\r\n    tooltips: {\r\n      barrier: { my: \"left-215 top+10\", at: \"left bottom\", collision: \"flipfit\" },\r\n      barrier_p: { my: \"left-5 top+10\", at: \"left bottom\", collision: \"flipfit\" },\r\n    },\r\n    template: {\r\n      name: '',\r\n      visible: false,\r\n    },\r\n    openHelp: ()=>{\r\n      $.growl.notice({message:\"Loading help text for \".i18n() + state.categories.value});\r\n      help.showSpecificContent(state.categories.value);\r\n    }\r\n  };\r\n\r\n  var update_currency = function() {\r\n    /* change currency on user login */\r\n    if(liveapi.is_authenticated()) {\r\n      liveapi.send({payout_currencies: 1})\r\n             .then(function(data){\r\n               state.currency.value = data.payout_currencies[0];\r\n               state.currency.array = data.payout_currencies;\r\n             })\r\n             .catch(function(err) { console.error(err); });\r\n    }\r\n  };\r\n\r\n  state.template.hide = function(e) {\r\n    if($(e.target).closest('.trade-template-manager').length === 0) {\r\n      state.template.visible = false;\r\n    }\r\n  }\r\n  state.template.toggle = function() {\r\n    state.template.visible = !state.template.visible;\r\n  }\r\n\r\n  state.barriers.root = state; // reference to root object for computed properties\r\n\r\n  state.date_expiry.update_times = function(){\r\n      trading_times_for(state.date_expiry.value_date, state.proposal.symbol)\r\n        .then(function(times) {\r\n          var expiry = state.date_expiry;\r\n          expiry.today_times.open = times.open;\r\n          expiry.today_times.close = times.close;\r\n          var range = _(state.duration_unit.ranges).filter(['type', 'minutes']).head();\r\n          expiry.today_times.disabled = !range;\r\n          var value_hour = range ? moment.utc().add(range.min+1, 'm').format('HH:mm') : \"00:00\";\r\n          expiry.value_hour = value_hour > expiry.value_hour ? value_hour : expiry.value_hour;\r\n          // /* avoid 'Contract may not expire within the last 1 minute of trading.' */\r\n          // value_hour = moment(times.close, 'HH:mm:ss').subtract(1, 'minutes').format('HH:mm');\r\n          // expiry.value_hour = value_hour < expiry.value_hour ? value_hour : expiry.value_hour;\r\n      });\r\n  }\r\n\r\n  state.categories.update = function (msg) {\r\n    var name = state.categories.value;\r\n    state.category_displays.array = _(available).filter(['contract_category_display', name]).map('contract_display').uniq().value();\r\n    state.category_displays.selected = _.head(state.category_displays.array);\r\n  };\r\n\r\n  state.category_displays.onclick = function (e) {\r\n    state.category_displays.selected = $(e.target).attr('data');\r\n  };\r\n\r\n  state.date_start.update = function () {\r\n    var forward_starting_options = _(available).filter({\r\n      'contract_category_display': state.categories.value,\r\n      'contract_display': state.category_displays.selected,\r\n      'start_type': 'forward'\r\n    }).head();\r\n    // For markets with spot start_type\r\n    var spot_starting_options = _(available).filter({\r\n      'contract_category_display': state.categories.value,\r\n      'contract_display': state.category_displays.selected,\r\n      'start_type': 'spot'\r\n    }).head();\r\n\r\n    if (!forward_starting_options) {\r\n      _.assign(state.date_start, { visible: false, array: [], value: 'now' });\r\n      return;\r\n    };\r\n\r\n    forward_starting_options = forward_starting_options.forward_starting_options\r\n    var model = state.date_start;\r\n    var array = [];\r\n    // Add 'NOW' to start time only if the market contains spot start_type.\r\n    if(spot_starting_options){\r\n      array = [{ text: 'Now', value: 'now' }];\r\n    }\r\n    var later = (new Date().getTime() + 5*60*1000)/1000; // 5 minute from now\r\n    _.each(forward_starting_options, function (row) {\r\n      var step = 5 * 60; // 5 minutes step\r\n      var from = Math.ceil(Math.max(later, row.open) / step) * step;\r\n      for (var epoch = from; epoch < row.close; epoch += step) {\r\n        var d = new Date(epoch * 1000);\r\n        var text = (\"00\" + d.getUTCHours()).slice(-2) + \":\" +\r\n        (\"00\" + d.getUTCMinutes()).slice(-2) + ' ' +\r\n        ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][d.getUTCDay()];\r\n        array.push({ text: text, value: epoch });\r\n      }\r\n    });\r\n    var options = { value: array[0].value, array: array, visible: true };\r\n    if(_.some(array, {value: state.date_start.value*1})) {\r\n      options.value = state.date_start.value;\r\n    }\r\n    _.assign(state.date_start, options);\r\n  };\r\n\r\n  state.date_expiry.update = function (date_or_hour) {\r\n    var expiry = state.date_expiry;\r\n    /* contracts that are more not today must end at the market close time */\r\n    var is_today = !moment.utc(expiry.value_date).isAfter(moment.utc(),'day');\r\n    if(!is_today){\r\n        expiry.today_times.disabled = true;\r\n        trading_times_for(expiry.value_date, state.proposal.symbol)\r\n          .then(function(times){\r\n            var value_hour = times.close !== '--' ? times.close : '00:00:00';\r\n            expiry.value_hour = moment(value_hour, \"HH:mm:ss\").format('HH:mm');\r\n            expiry.value = moment.utc(expiry.value_date + \" \" + value_hour).unix();\r\n            state.barriers.update();\r\n            debounce(expiry.value, state.proposal.onchange);\r\n          });\r\n    }\r\n    else {\r\n        if(date_or_hour !== expiry.value_hour) { expiry.update_times(); }\r\n        expiry.value = moment.utc(expiry.value_date + \" \" + expiry.value_hour).unix();\r\n        state.barriers.update();\r\n        debounce(expiry.value, state.proposal.onchange);\r\n    }\r\n  }\r\n\r\n  state.duration.update = function () {\r\n    var category = state.categories.value;\r\n    if (_([\"Up/Down\", \"In/Out\", \"Touch/No Touch\"]).includes(category)) {\r\n      if(state.duration.array.length !== 2)\r\n        state.duration.array = ['Duration', 'End Time'];\r\n    }\r\n    else {\r\n      state.duration.value = 'Duration';\r\n      if(state.duration.array.length !== 1)\r\n        state.duration.array = ['Duration'];\r\n    }\r\n  };\r\n\r\n  state.duration_unit.update = function () {\r\n    var start_type = state.date_start.value !== 'now' ? 'forward' : 'spot';\r\n\r\n    var durations = _(available).filter({\r\n      'contract_category_display': state.categories.value,\r\n      'contract_display': state.category_displays.selected,\r\n      'start_type': start_type\r\n    })\r\n    .map(function (r) {\r\n      return {\r\n        min: r.min_contract_duration + '',\r\n        max: r.max_contract_duration + '',\r\n        type: r.expiry_type\r\n      }\r\n    }).value();\r\n\r\n    var array = [];\r\n    var ranges = [];\r\n    _.each(durations, function (d) {\r\n      if (_(['tick', 'daily']).includes(d.type)) {\r\n        array.push({ tick: 'ticks', daily: 'days' }[d.type]);\r\n        ranges.push({\r\n          min: d.min.replace('d', '').replace('t','') | 0,\r\n          max: d.max.replace('d', '').replace('t','') | 0,\r\n          type: { tick: 'ticks', daily: 'days' }[d.type]\r\n        });\r\n        return;\r\n      }\r\n      /* fix intraday duration intervals */\r\n      var min = d.min.replace('s', '').replace('m', '').replace('h',''),\r\n          max = d.max.replace('s', '').replace('m', '').replace('h','').replace('d', '');\r\n      var min_unit = _(d.min).last(),\r\n          max_unit = _(d.max).last();\r\n\r\n      min *= { 's': 1, 'm': 60, 'h': 3600 }[min_unit];                 // convert to seconds\r\n      max *= { 's': 1, 'm': 60, 'h':3600, 'd': 3600 * 24 }[max_unit];\r\n\r\n      if('s' === min_unit) {\r\n        array.push('seconds');\r\n        ranges.push({ min: min, max: max, type: 'seconds'});\r\n      }\r\n      if(_(['s', 'm']).includes(min_unit) && max >= 60) {\r\n        array.push('minutes');\r\n        ranges.push({ min: Math.max(min / 60, 1), max: max / 60, type: 'minutes' });\r\n      }\r\n      if(_(['s', 'm', 'h']).includes(min_unit) && max >= 3600) {\r\n        array.push('hours');\r\n        ranges.push({ min: Math.max(min / 3600, 1), max: max / 3600, type: 'hours' });\r\n      }\r\n    });\r\n\r\n    /* sort the arrays */\r\n    var sort_dict = { 'ticks': 0, 'seconds': 1, 'minutes': 2, 'hours': 3, 'days': 4 };\r\n    array.sort(function (r1, r2) { return sort_dict[r1] - sort_dict[r2]; });\r\n    ranges.sort(function(r1,r2){ return sort_dict[r1.type] - sort_dict[r2.type]; })\r\n\r\n    if (!array.length) {\r\n      state.barriers.update();\r\n      return;\r\n    }\r\n\r\n    state.duration_unit.ranges = ranges;\r\n    if(!_.includes(array,state.duration_unit.value)){\r\n      state.duration_unit.value = _.head(array);\r\n    }\r\n    else {\r\n      state.duration_count.update(true);\r\n    }\r\n\r\n    state.duration_unit.array = array;\r\n\r\n    /* manualy notify 'duration_count' and 'barriers' to update themselves */\r\n    state.barriers.update();\r\n    state.date_expiry.update_times();\r\n  };\r\n\r\n  state.duration_count.update = function (try_to_keep_value) {\r\n    var range = _(state.duration_unit.ranges).filter({'type': state.duration_unit.value}).head();\r\n    if (!range) return;\r\n    state.duration_count.min = range.min;\r\n    state.duration_count.max = range.max;\r\n    if(try_to_keep_value !== true) {\r\n      state.duration_count.value = range.min;\r\n    }\r\n    else if(state.duration_count.value < range.min || state.duration_count.value > range.max) {\r\n      state.duration_count.value = range.min;\r\n    }\r\n  };\r\n\r\n  state.digits.update = function() {\r\n      var subcat = state.category_displays.selected;\r\n      if(state.categories.value !== 'Digits' || subcat === 'odd' || subcat === 'even') {\r\n        state.digits.visible = false;\r\n        return;\r\n      }\r\n\r\n      var array = {\r\n        matches: ['0', '1','2','3','4','5','6','7','8', '9'],\r\n        differs: ['0', '1','2','3','4','5','6','7','8', '9'],\r\n        under: ['1','2','3','4','5','6','7','8', '9'],\r\n        over: ['0','1','2','3','4','5','6','7','8'],\r\n      }[subcat];\r\n      var text = {\r\n        matches: 'Last Digit Prediction'.i18n(),\r\n        differs: 'Last Digit Prediction'.i18n(),\r\n        under: 'Last Digit is Under'.i18n(),\r\n        over: 'Last Digit is Over'.i18n()\r\n      }[subcat];\r\n\r\n      if(!_.includes(array, state.digits.value)){\r\n        state.digits.value = array[0];\r\n      }\r\n      state.digits.array = array;\r\n      state.digits.text = text;\r\n      state.digits.visible = true;\r\n  };\r\n\r\n  state.barriers.update = function () {\r\n    var unit = state.duration_unit.value;\r\n    var expiry_type = _(['seconds', 'minutes', 'hours']).includes(unit) ? 'intraday' : unit === 'days' ? 'daily' : 'tick';\r\n    var barriers = _(available).filter({\r\n      'contract_category_display': state.categories.value,\r\n      'contract_display': state.category_displays.selected,\r\n      'expiry_type':expiry_type\r\n    }).filter(function (r) { return r.barriers >= 1; }).head();\r\n\r\n    state.barriers.barrier_count = barriers ? barriers.barriers : 0;\r\n    if (!barriers)\r\n      return;\r\n\r\n     var update_barrier = function(barrier, perv_barrier, new_barrier, was_perv_barrier_daily, sign) {\r\n        var is_daily = (expiry_type === 'daily' && state.duration.value !== 'End Time') ||\r\n           (state.duration.value === 'End Time' && moment.utc(state.date_expiry.value_date).isAfter(moment.utc(),'day'));\r\n        if(is_daily) {\r\n           if(was_perv_barrier_daily) {\r\n              perv_barrier = barrier;\r\n           }\r\n           barrier = (was_perv_barrier_daily ? barrier : 0) || new_barrier;\r\n           was_perv_barrier_daily = true;\r\n        }\r\n        else {\r\n           var def_barrier = (new_barrier*1 >= 0 ? sign : '') + new_barrier*1;\r\n           if(was_perv_barrier_daily && /^[+-]/.test(perv_barrier)) {\r\n              barrier = perv_barrier;\r\n           }\r\n           else if(!/^[+-]/.test(barrier)) {\r\n              barrier = def_barrier;\r\n           }\r\n           else {} // no need to update it\r\n           perv_barrier = barrier;\r\n           was_perv_barrier_daily = false;\r\n        }\r\n        return {\r\n           barrier: barrier,\r\n           perv_barrier: perv_barrier,\r\n           was_perv_barrier_daily: was_perv_barrier_daily\r\n        };\r\n     }\r\n    if(barriers.barrier) {\r\n       var result = update_barrier(state.barriers.barrier, state.barriers.perv_barrier,\r\n          barriers.barrier, state.barriers.was_perv_barrier_daily, '+');\r\n       state.barriers.barrier = result.barrier;\r\n       state.barriers.perv_barrier = result.perv_barrier;\r\n       state.barriers.was_perv_barrier_daily = result.was_perv_barrier_daily;\r\n    }\r\n    if(barriers.high_barrier){\r\n       var result = update_barrier(state.barriers.high_barrier, state.barriers.perv_high_barrier,\r\n          barriers.high_barrier, state.barriers.was_perv_high_barrier_daily, '+');\r\n       state.barriers.high_barrier = result.barrier;\r\n       state.barriers.perv_high_barrier = result.perv_barrier;\r\n       state.barriers.was_perv_high_barrier_daily = result.was_perv_barrier_daily;\r\n    }\r\n    if(barriers.low_barrier){\r\n       var result = update_barrier(state.barriers.low_barrier, state.barriers.perv_low_barrier,\r\n          barriers.low_barrier, state.barriers.was_perv_low_barrier_daily, '-');\r\n       state.barriers.low_barrier = result.barrier;\r\n       state.barriers.perv_low_barrier = result.perv_barrier;\r\n       state.barriers.was_perv_low_barrier_daily = result.was_perv_barrier_daily;\r\n    }\r\n  };\r\n\r\n  state.basis.update_limit = function () {\r\n    var basis = state.basis;\r\n    var limit = _(available).filter({\r\n      'contract_category_display': state.categories.value,\r\n      'contract_display': state.category_displays.selected\r\n    }).head();\r\n\r\n    limit = (limit && limit.payout_limit) || null;\r\n    basis.limit = limit ? (limit * 1) : null;\r\n    if(basis.limit) {\r\n      basis.amount = Math.min(basis.amount, basis.limit);\r\n    }\r\n  };\r\n\r\n  state.proposal.onchange = function () {\r\n    var unit = state.duration_unit.value;\r\n    var expiry_type = _(['seconds', 'minutes', 'hours']).includes(unit) ? 'intraday' : unit === 'days' ? 'daily' : 'tick';\r\n    if(state.categories.value === 'Spreads') expiry_type = 'intraday';\r\n    var row = _(available).filter({\r\n      'contract_category_display': state.categories.value,\r\n      'contract_display': state.category_displays.selected,\r\n      'expiry_type': expiry_type\r\n    }).head();\r\n    var request = {\r\n      proposal: 1,\r\n      subscribe: 1,\r\n      contract_type: row.contract_type,\r\n      currency: state.currency.value, /* This can only be the account-holder's currency */\r\n      symbol: state.proposal.symbol, /* Symbol code */\r\n    };\r\n    if(state.categories.value !== 'Spreads') {\r\n      request.amount = state.basis.amount*1; /* Proposed payout or stake value */\r\n      request.basis = state.basis.value; /* Indicate whether amount is 'payout' or 'stake */\r\n    } else {\r\n      request.amount_per_point = state.spreads.amount_per_point;\r\n      request.stop_type = state.spreads.stop_type;\r\n      request.stop_loss = state.spreads.stop_loss;\r\n      request.stop_profit = state.spreads.stop_profit;\r\n    }\r\n    /* set the value for barrier(s) */\r\n    if (state.barriers.barrier_count == 1) {\r\n      request.barrier = state.barriers.barrier;\r\n    }\r\n    if (state.barriers.barrier_count == 2) {\r\n      request.barrier = state.barriers.high_barrier;\r\n      request.barrier2 = state.barriers.low_barrier + '';\r\n    }\r\n    if (state.categories.value === 'Digits') {\r\n      request.barrier = state.digits.value + '';\r\n    }\r\n    if (state.date_start.value !== 'now') {\r\n      request.date_start = state.date_start.value * 1;\r\n    }\r\n    /* set value for duration or date_expiry */\r\n    if (state.duration.value === 'Duration') {\r\n      request.duration_unit = _(state.duration_unit.value).head(); //  (d|h|m|s|t), Duration unit is s(seconds), m(minutes), h(hours), d(days), t(ticks)\r\n      if(state.duration_count.value < 1) {\r\n        state.duration_count.value = 1;\r\n        return;\r\n      }\r\n      request.duration = state.duration_count.value * 1;\r\n    }\r\n    else {\r\n      request.date_expiry = state.date_expiry.value;\r\n    }\r\n\r\n    state.proposal.loading = true;\r\n    /* forget previous proposal request */\r\n    if(state.proposal.last_promise) {\r\n      state.proposal.last_promise.then(function(data){\r\n        var id = data && data.proposal && data.proposal.id;\r\n        id && liveapi.send({forget: id});\r\n      });\r\n    }\r\n\r\n    var new_proposal_promise = liveapi.send(request)\r\n      .then(function (data) {\r\n        /* OK, this is the last sent request */\r\n        if(new_proposal_promise === state.proposal.last_promise) {\r\n          var id = data.proposal && data.proposal.id;\r\n          state.proposal.error = '';\r\n          state.proposal.id = id;\r\n        }\r\n        return data;\r\n      })\r\n      .catch(function (err) {\r\n        console.error(err);\r\n        state.proposal.error = err.message;\r\n        state.proposal.message = '';\r\n        state.proposal.loading = false;\r\n        if (err.echo_req && err.echo_req.proposal && err.details) {\r\n          state.proposal.ask_price = err.details.display_value;\r\n          state.proposal.message = err.details.longcode;\r\n        }\r\n        return err;\r\n      });\r\n    /* update last_promise to invalidate previous requests */\r\n    state.proposal.last_promise = new_proposal_promise;\r\n    state.proposal.id = ''; /* invalidate last proposal.id */\r\n\r\n    dialog.update_track(dialog.get_template());\r\n  };\r\n\r\n  state.purchase.onclick = async function() {\r\n    state.purchase.loading = true;\r\n    var show = function(div){\r\n      div.appendTo(root);\r\n\r\n      root.find('.trade-fields').css({ left : '350px'});\r\n      root.find('.trade-conf').css({ left : '0'});\r\n      // root.find('.trade-fields').animate({ left : '+=350'}, 1000, 'linear');\r\n      // root.find('.trade-conf').animate({ left : '+=350'}, 1000, 'linear');\r\n    };\r\n    var hide = function(div){\r\n      root.find('.trade-fields').css({ left : '0'});\r\n      root.find('.trade-conf').css({ left : '-350px'});\r\n      // root.find('.trade-fields').animate({ left : '-=350'}, 500, 'linear');\r\n      // root.find('.trade-conf').animate({ left : '-=350'}, 500, 'linear', function(){ ... });\r\n      state.purchase.loading = false;\r\n      div.remove();\r\n      /* trigger a new proposal stream */\r\n      state.proposal.onchange();\r\n    }\r\n\r\n    /* workaround for api not providing this fields */\r\n    var extra = {\r\n        currency: state.currency.value,\r\n        symbol: state.proposal.symbol,\r\n        symbol_name: state.proposal.symbol_name,\r\n        category: state.categories.value,\r\n        category_display: state.category_displays.selected,\r\n        duration_unit: state.duration_unit.value,\r\n        pip: symbol.pip,\r\n    };\r\n    /* pass data which is needed to show live tick purchase results */\r\n    extra.show_tick_chart = false;\r\n    if(_(['Digits','Up/Down','Asians']).includes(extra.category) && state.duration.value === 'Duration' && extra.duration_unit === 'ticks') {\r\n        extra.digits_value = state.digits.value;\r\n        extra.tick_count = state.duration_count.value*1;\r\n        if(extra.category !== 'Digits') {\r\n          if (extra.category !== 'Asians') {\r\n            extra.tick_count += 1; /* we are shwoing X ticks arfter the initial tick so the total will be X+1 */\r\n          }\r\n          /* for higher/lower final barrier value is entry_quote + barrrier */\r\n          if(extra.category === 'Up/Down' && _(['higher','lower']).includes(extra.category_display)) {\r\n            extra.barrier = state.barriers.barrier;\r\n          }\r\n          extra.show_tick_chart = true;\r\n        }\r\n    }\r\n\r\n    // manually check to see if the user is authenticated or not,\r\n    // we should update state.currency from user profile first (not everyone is using USD)\r\n    if(!liveapi.is_authenticated()) {\r\n        $.growl.warning({ message: 'Please log in'.i18n() });\r\n        state.purchase.loading = false;\r\n        return;\r\n    }\r\n    try {\r\n        const [tradeConf] = await require(['trade/tradeConf']);\r\n        const data = await liveapi.send({\r\n                buy: state.proposal.id,\r\n                price: state.proposal.ask_price * 1,\r\n             });\r\n        extra.contract_id = data.buy.contract_id;\r\n        extra.transaction_id = data.buy.transaction_id;\r\n        if(extra.show_tick_chart || extra.category === 'Digits') {\r\n          liveapi.proposal_open_contract.subscribe(extra.contract_id);\r\n        }\r\n        tradeConf.init(data, extra, show, hide, symbol);\r\n    }\r\n    catch(err) {\r\n        state.purchase.loading = false;\r\n        $.growl.error({ message: err.message });\r\n        console.error(err);\r\n        /*Logout if the error code is 42*/\r\n        if (err.code === 'InvalidToken') {\r\n          liveapi.invalidate();\r\n        } else {\r\n          /* trigger a new proposal stream */\r\n          state.proposal.onchange();\r\n        }\r\n    }\r\n  };\r\n\r\n  state.categories.array = _(available).map('contract_category_display').uniq().value();\r\n  state.categories.value = _(state.categories.array).includes('Up/Down') ? 'Up/Down' : _(state.categories.array).head(); // TODO: show first tab\r\n\r\n  var tick_stream_alive = false;\r\n  /* register for tick stream of the corresponding symbol */\r\n  liveapi.events.on('tick', function (data) {\r\n      if (data.tick && data.tick.symbol == state.proposal.symbol) {\r\n          tick_stream_alive = true;\r\n          // if(state.purchase.loading) return; /* don't update ui while loading confirmation dialog */\r\n          state.tick.perv_quote = state.tick.quote;\r\n          state.tick.epoch = data.tick.epoch;\r\n          state.tick.quote = data.tick.quote;\r\n          state.ticks.loading = false;\r\n          /* update ticks for sparkline chart */\r\n          if(state.ticks.array.length > 30) {\r\n            state.ticks.array.shift();\r\n          }\r\n          state.ticks.array.push(data.tick);\r\n      }\r\n  });\r\n  /* register for proposal event */\r\n  liveapi.events.on('proposal', function (data) {\r\n      // Specifically for microsoft products. Need to wait for other functions to finish\r\n      //We can move the code out of the defer function once windows becomes obsolete or if it stops making browsers. >.<\r\n      _.defer(function(){\r\n          if (!data.proposal || data.proposal.id !== state.proposal.id) return;\r\n          if(data.error){\r\n            console.error(data.error);\r\n            state.proposal.error = data.error.message;\r\n            state.proposal.message = '';\r\n            return;\r\n          }\r\n          if(state.purchase.loading) return; /* don't update ui while loading confirmation dialog */\r\n          /* update fields */\r\n          var proposal = data.proposal;\r\n          state.proposal.ask_price = proposal.ask_price;\r\n          state.proposal.date_start = proposal.date_start;\r\n          state.proposal.display_value = proposal.display_value;\r\n          state.proposal.message = proposal.longcode;\r\n          state.proposal.payout = proposal.payout;\r\n          state.proposal.spot = proposal.spot;\r\n          state.proposal.spot_time = proposal.spot_time;\r\n          state.spreads.spread = proposal.spread || 0.0;\r\n          state.spreads.spot = proposal.spot || '0.0';\r\n          state.spreads.spot_time = proposal.spot_time || '0';\r\n          state.proposal.loading = false;\r\n          if(!tick_stream_alive && proposal.spot) { /* for contracts that don't have live qoute data */\r\n            state.tick.epoch = proposal.spot_time;\r\n            state.tick.quote = proposal.spot;\r\n          }\r\n      });\r\n  });\r\n\r\n  liveapi.events.on('set_account_currency', update_currency);\r\n\r\n  update_currency();\r\n\r\n  return state;\r\n}\r\nexport function init(symbol, contracts_for, saved_template, isTrackerInitiated) {\r\n    var root = $(html).i18n();\r\n    var available = apply_fixes(contracts_for.available);\r\n\r\n    var dialog = windows.createBlankWindow(root, {\r\n        title: symbol.display_name,\r\n        resizable: false,\r\n        collapsable: false,\r\n        minimizable: true,\r\n        maximizable: false,\r\n        'data-authorized': 'true',\r\n        isTrackerInitiated: isTrackerInitiated,\r\n        relativePosition: true,\r\n        close: function() {\r\n          /* forget last proposal stream on close */\r\n          if(state.proposal.last_promise) {\r\n            state.proposal.last_promise.then(function(data){\r\n              var id = data.proposal && data.proposal.id;\r\n              id && liveapi.send({forget: id});\r\n            });\r\n          }\r\n          chartingRequestMap.unregister(key);\r\n          view.unbind();\r\n          dialog.destroy();\r\n        }\r\n    });\r\n    var update_track = dialog.track({\r\n      module_id: 'tradeDialog',\r\n      is_unique: false,\r\n      data: {\r\n        symbol : symbol,\r\n        template: saved_template || {}\r\n      }\r\n    });\r\n\r\n    /********************** register for ticks_streams **********************/\r\n    var key = chartingRequestMap.keyFor(symbol.symbol, /* granularity = */ 0);\r\n    var has_digits = _(available).map('min_contract_duration')\r\n                      .some(function(duration){ return /^\\d+$/.test(duration) || (_.last(duration) === 't'); });\r\n    if(!chartingRequestMap[key]){ /* don't register if already someone else has registered for this symbol */\r\n        chartingRequestMap.register({\r\n          symbol: symbol.symbol,\r\n          subscribe: 1,\r\n          granularity: 0,\r\n          count: 1000, /* this will be for the case that the user opens a the same tick chart later */\r\n          style: 'ticks'\r\n        }).catch(function (err) {\r\n          /* if this contract offers tick trades, prevent user from trading */\r\n          if(has_digits) {\r\n            $.growl.error({ message: err.message });\r\n            _.delay(function(){ dialog.dialog('close'); },2000);\r\n          }\r\n          console.error(err);\r\n        });\r\n    }\r\n    else { chartingRequestMap.subscribe(key); }\r\n\r\n    var state = init_state(available,root,dialog, symbol, contracts_for.spot);\r\n    if(!has_digits) { state.ticks.loading = false; }\r\n    var view = rv.bind(root[0],state)\r\n    state.categories.update();            // trigger update to init categories_display submenu\r\n\r\n    dialog.dialog('open');\r\n\r\n    dialog.update_track = function(template) {\r\n      update_track({symbol: symbol, template: template});\r\n    }\r\n    dialog.get_template = get_current_template.bind(undefined, state);\r\n    dialog.set_template = set_current_template.bind(undefined, state);\r\n    saved_template && (saved_template.name !== undefined)\r\n                  && dialog.set_template(saved_template);\r\n    dialog.hide_template_menu = function() { state.template.visible = false; }\r\n    require(['trade/tradeTemplateManager'], function(tradeTemplateManager) {\r\n      tradeTemplateManager.init(root.find('.trade-template-manager-root'), dialog);\r\n    });\r\n    // window.state = state; window.av = available; window.moment = moment; window.dialog = dialog; window.times_for = trading_times_for;\r\n    return dialog; // used in tracker to set position.\r\n}\r\n\r\nexport default { init, };\r\n"]}