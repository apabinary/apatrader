{"version":3,"sources":["../../../../src/windows/windows.es6"],"names":["closeAllObject","dialogCounter","$menuUL","last_dialog","calculateChartCount","options","extend","width","height","rows","Math","floor","window","cols","isSmallView","total","shuffle","array","temp","rand_inx","inx","length","random","callbacks","fire_event","name","args","fns","forEach","cb","setTimeout","apply","undefined","tileDialogs","dialogs","filter","d","$d","hasClass","dialog","arrange","perform","total_free_space","max_x","y","inx_start","row_height","x","w","h","max","free_space","margin_left","j","animate","left","top","trigger","bind","my","at","fixFooterPosition","best","best_free_space","i","slice","largeDialogs","push","addDateToHeader","title","date","changed","cleared","header","parent","find","addClass","addDateDropDowns","opts","numberOfDays","year","month","isLeap","update","select","render","v","children","remove","min","val","text","appendTo","initial","selectmenu","_title","prependTo","updating","value","dt","Date","insertAfter","day","getFullYear","getMonth","getDate","trigger_change","yyyy_mm_dd","UTC","toISOString","onchange","on","update_day","split","clear","addDatePicker","dpicker_input","add_clear_button","input","button_pane","datepicker","i18n","click","onclear","showOn","numberOfMonths","maxDate","minDate","dateFormat","showAnim","showButtonPanel","changeMonth","changeYear","onSelect","change","beforeShow","inst","dpDiv","css","marginTop","marginLeft","onChangeMonthYear","closeText","currentText","dpicker","_gotoToday","id","next","button","icons","primary","dropdonws","getScrollHeight","without_body","bottoms","map","$w","offset","fixMinimizedDialogsPosition","footer_height","scroll_bottom","document","scrollTop","init","$parentObj","original","fn","cmd","call","arguments","tileObject","require","chartWindowObj","liveapi","menu","is_empty","reopen","counts","cached","send","trading_times","then","markets","extractChartableMarkets","rand","arr","timePeriods","chartTypes","submarkets","symbols","instruments","sym","timePeriod","chart_type","addNewWindow","instrumentCode","symbol","instrumentName","display_name","type","delayAmount","delay_amount","local_storage","get","oauth","Promise","all","authorize","acc","token","req","results","data","unshift","is_jpy_account","loginid","is_virtual","landing_company_name","indexOf","set","invalidate","growl","error","message","duration","catch","err","code","ele","match","switch_account","console","resize","scroll","only_on_expand","scroll_height","body_height","current_height","new_height","closeAll","createBlankWindow","$html","autoOpen","resizable","collapsable","of","hide","close","minimize","maximize","open","promise","done","changePos","pos","parseInt","minWidth","minHeight","restore","blankWindow","attr","ignoreTileAction","dialogExtend","draggable","destroy","moveToTop","effect","times","distance","li","add_to_windows_menu","link","html","append","attributes","Object","keys","key","startsWith","refresh","track","makeSelectmenu","list","update_select","update_list","new_list","event_on","event_off","index","splice","tile"],"mappings":"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","file":"windows.js","sourcesContent":["\r\n/**\r\n * Created by arnab on 2/18/15.\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport _ from 'lodash';\r\nimport navigation from 'navigation/navigation';\r\nimport tracker from 'windows/tracker';\r\nimport 'jquery.dialogextend';\r\nimport 'modernizr';\r\nimport 'common/util';\r\nimport 'css!windows/windows.css';\r\n\r\nlet closeAllObject = null, dialogCounter = 0, $menuUL = null, last_dialog = null;\r\n\r\n/* options: { width: 350, height: 400 } */\r\nconst calculateChartCount = (options) => {\r\n   options = $.extend({ width: 350, height: 400 }, options);\r\n   let rows = Math.floor($(window).height() / options.height) || 1,\r\n      cols = Math.floor($(window).width() / options.width) || 1;\r\n\r\n   if (isSmallView()) //For small size screens\r\n      rows = cols = 1;\r\n   /**** limi the number of charts to 4 ****/\r\n   if(rows * cols > 4) {\r\n      rows = 1;\r\n      cols = 4;\r\n   };\r\n   return {\r\n      rows: rows,\r\n      cols: cols,\r\n      total: rows * cols\r\n   };\r\n}\r\n\r\n/* shuffle the given array */\r\nconst shuffle = (array) => {\r\n   let temp, rand_inx;\r\n\r\n   for (let inx = array.length; inx > 0;) {\r\n      rand_inx = Math.floor(Math.random() * inx);\r\n      --inx;\r\n      temp = array[inx];\r\n      array[inx] = array[rand_inx];\r\n      array[rand_inx] = temp;\r\n   }\r\n\r\n   return array;\r\n}\r\n\r\nlet callbacks = {};\r\n/* fire a custom event and call registered callbacks(api.events.on(name)) */\r\nconst fire_event = (name , ...args) => {\r\n   const fns = callbacks[name] || [];\r\n   fns.forEach(function (cb) {\r\n      setTimeout(function(){\r\n         cb.apply(undefined, args);\r\n      },0);\r\n   });\r\n}\r\n\r\nconst tileDialogs = () => {\r\n   // get array of dialogs\r\n   var dialogs = $('.webtrader-dialog').filter((inx, d) => {\r\n      /* check to see if initialized and is visible */\r\n      const $d = $(d);\r\n      return $d.hasClass(\"ui-dialog-content\") && $d.dialog(\"isOpen\") &&\r\n            !$d.hasClass('ui-dialog-minimized') && ($(window).width() >= $d.dialog('option', 'width'));\r\n   });\r\n\r\n\r\n   const arrange = (dialogs, perform) => {\r\n      let total_free_space = 0;\r\n\r\n      const max_x = $(window).width();\r\n      let y = 110; // position of the next window from top\r\n\r\n      for (var inx = 0; inx < dialogs.length;) {\r\n         var inx_start = inx;\r\n         var row_height = 0; // height of the current row of dialogs\r\n         var x = 0; // positon of the next window from left\r\n\r\n         for (;/* see which which dialogs fit into current row */;) {\r\n            if (inx == dialogs.length)\r\n               break;\r\n            const d = $(dialogs[inx]);\r\n            const w = d.dialog('option', 'width'),\r\n               h = d.dialog('option', 'height');\r\n            row_height = Math.max(row_height, h);\r\n            if (x + w <= max_x) {\r\n               x += w;\r\n               ++inx;\r\n            }\r\n            else\r\n               break;\r\n         }\r\n\r\n         /* divide the vertical space equally between dialogs. */\r\n         const free_space = x < max_x ? (max_x - x) : 0;\r\n         let margin_left = x < max_x ? (max_x - x) / (inx - inx_start + 1) : 0; /* the current window might be wider than screen width */\r\n         if(inx != dialogs.length) { /* we don't care about extra space at last row */\r\n            total_free_space += free_space;\r\n         }\r\n         if (x === 0 && $(dialogs[inx]).dialog('option', 'width') > max_x) {\r\n            ++inx;\r\n            margin_left = 0;\r\n         };\r\n         x = 0;\r\n         for (var j = inx_start; j < inx; ++j) {\r\n            x += margin_left;\r\n            const d = $(dialogs[j]);\r\n            const w = d.dialog('option', 'width'),\r\n               h = d.dialog('option', 'height');\r\n\r\n            if(perform) /* are we testing or do we want to arrange elements */\r\n               d.dialog('widget').animate({\r\n                  left: x + 'px',\r\n                  top: y + 'px'\r\n               }, 1500, d.trigger.bind(d, 'animated'));\r\n            /* update dialog option.position */\r\n            d.dialog(\"option\", \"position\", { my: x, at: y });\r\n            x += w;\r\n         };\r\n         y += row_height + 20;\r\n      }\r\n      if(perform) { // fix footer postion on tile action\r\n         setTimeout(fixFooterPosition, 1500 + 100);\r\n      }\r\n      return total_free_space;\r\n   }\r\n\r\n   /* we will try 100 different arrangements and pick the best one */\r\n   let best = null,\r\n      best_free_space = 1000*1000;\r\n   for (var i = 0; i < 100; ++i) {\r\n      shuffle(dialogs); // shuffle dialogs\r\n      var total_free_space = arrange(dialogs, false);\r\n      if (total_free_space < best_free_space) {\r\n         best = dialogs.slice(); // clone the array\r\n         best_free_space = total_free_space;\r\n      }\r\n   }\r\n   // get array of large dialogs (larger than window size)\r\n   const largeDialogs = $('.webtrader-dialog').filter(function (inx, d) {\r\n      /* check to see if initialized and is visible */\r\n      const $d = $(d);\r\n      return $d.hasClass(\"ui-dialog-content\") && $d.dialog(\"isOpen\") && !$d.hasClass('ui-dialog-minimized') && ($(window).width() < $d.dialog('option', 'width'));\r\n   });\r\n   _(largeDialogs).forEach(function (d) {\r\n      best.push(d);\r\n   });\r\n   arrange(best, true);\r\n   //Do not track last dialog after re-arranging dialogs\r\n   last_dialog = null;\r\n   //Trigger tile when the animation is done\r\n   setTimeout(() => fire_event(\"tile\"), 1500 + 100);\r\n}\r\n\r\n/*\r\n     @param: options.date    javascript Date object representing initial time\r\n     @param: options.title   the header title for spinners\r\n     @param: options.changed  called when Date changes, callback argument is a string in yyyy_mm_dd format.\r\n   useage:\r\n      var win = createBlankWindow(...);\r\n      win.addDateToHeader({date:new Date(), title: 'sub header', changed: fn});\r\n      */\r\nconst addDateToHeader = function(options) {\r\n   options = $.extend({\r\n      title: 'title',\r\n      date: null,\r\n      changed: () => { },\r\n      cleared: () => { }\r\n   },options);\r\n\r\n   const header = this.parent().find('.ui-dialog-title').addClass('with-content');\r\n\r\n\r\n   /* options: {date: date, onchange: fn } */\r\n   const addDateDropDowns = (opts) => {\r\n      // note that month is 0-based, like in the Date object. Adjust if necessary.\r\n      const numberOfDays = (year, month) => {\r\n         var isLeap = ((year % 4) == 0 && ((year % 100) != 0 || (year % 400) == 0));\r\n         return [31, (isLeap ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];\r\n      }\r\n\r\n      const update = function(select, options) {\r\n         var render = options.render || (v => v + '');\r\n         select.children().remove();\r\n         /* add the title */\r\n         for (let i = options.min; i <= options.max; ++i)\r\n            $('<option/>').val(i).text(render(i)).appendTo(select);\r\n         select.val(options.initial || options.min);\r\n         select.selectmenu('refresh');\r\n\r\n         select.title = select.title || (function(text) {\r\n            if (text) {\r\n               select._title = select._title || $('<option/>').val(-1).prependTo(select);\r\n               select._title.text(text);\r\n               select.updating = true;\r\n               select.val(-1).selectmenu('refresh');\r\n               select.updating = false;\r\n            }\r\n            else {\r\n               if (select._title) {\r\n                  const value = select.val() === -1 ? options.initial : select.val();\r\n                  select._title.remove();\r\n                  select.updating = true;\r\n                  select.val(value).selectmenu('refresh');\r\n                  select.updating = false;\r\n                  this._title = null;\r\n               }\r\n            }\r\n         });\r\n\r\n         return select;\r\n      }\r\n\r\n      const dt = opts.date || new Date();\r\n      let year = $('<select />').insertAfter(header).selectmenu({ width: 'auto' });\r\n      let month = $('<select />').insertAfter(header).selectmenu({ width: 'auto' });\r\n      let day = $('<select />').insertAfter(header).selectmenu({ width: 'auto'});\r\n      day.selectmenu( \"menuWidget\" ).addClass('date-day');\r\n      year = update(year, { min: 2010, max: dt.getFullYear(), initial: dt.getFullYear()});\r\n      month = update(month, {\r\n         min: 0, max: 11, initial: dt.getMonth(),\r\n         render: (inx) => ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'][inx]\r\n      });\r\n      day = update(day, { min: 1, max: numberOfDays(dt.getFullYear(),dt.getMonth()), initial: dt.getDate()});\r\n\r\n      /* add title elements if no date is specified */\r\n      if (!opts.date) {\r\n         year.title('Year');\r\n         month.title('Month');\r\n         day.title('Day');\r\n      }\r\n\r\n      const trigger_change = () => {\r\n         /* TODO: search other files and make sure to use a UTC date */\r\n         const yyyy_mm_dd = new Date(Date.UTC(year.val(), month.val(), day.val())).toISOString().slice(0, 10);\r\n         opts.onchange(yyyy_mm_dd);\r\n      }\r\n      day.on('selectmenuchange', () => {\r\n         if (day.updating) {\r\n            return;\r\n         }\r\n         day.title(null);\r\n         month.title(null);\r\n         year.title(null);\r\n\r\n         trigger_change();\r\n      });\r\n\r\n      const update_day = () => {\r\n         const options = { min: 1, max: numberOfDays(year.val(), month.val()), initial: day.val() };\r\n         if (options.initial > options.max)\r\n            options.initial = options.min;\r\n         update(day, options);\r\n      };\r\n\r\n      [year, month].forEach(function (select) {\r\n         select.on('selectmenuchange', function () {\r\n            if (month.updating || year.updating) return;\r\n            day.title(null);\r\n            month.title(null);\r\n            year.title(null);\r\n            update_day();\r\n            trigger_change();\r\n         });\r\n      })\r\n      return {\r\n         update: (yyyy_mm_dd) => {\r\n            day.title(null);\r\n            month.title(null);\r\n            year.title(null);\r\n            var args = yyyy_mm_dd.split('-');\r\n            year.val(args[0] | 0); year.selectmenu('refresh');\r\n            month.val((args[1] | 0)-1); month.selectmenu('refresh');\r\n            day.val(args[2] | 0); update_day();\r\n         },\r\n         clear: () => {\r\n            year.title('Year');\r\n            month.title('Month');\r\n            day.title('Day');\r\n         }\r\n      };\r\n   }\r\n\r\n   /* options: {date: date, onchange: fn} , events => element.on('change',...) */\r\n   const addDatePicker = (opts) => {\r\n      const dpicker_input = $(\"<input type='hidden' />\")\r\n         .insertAfter(header);\r\n      const add_clear_button = (input) => {\r\n         /* Run this after date-picker is constructed\r\n                Source: stackoverflow.com/questions/4598850 */\r\n         setTimeout(() => {\r\n            const button_pane = $(input)\r\n               .datepicker('widget')\r\n               .find('.ui-datepicker-buttonpane');\r\n\r\n            $('<button/>', {\r\n               text: 'Clear'.i18n(),\r\n               click: function () {\r\n                  opts.onclear && opts.onclear();\r\n                  $(input).datepicker('hide');\r\n               }\r\n            })\r\n               .addClass('ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all')\r\n               .appendTo(button_pane);\r\n         }, 0);\r\n      };\r\n\r\n      var options = {\r\n         showOn: 'both',\r\n         numberOfMonths: 1,\r\n         maxDate: 0,\r\n         minDate: new Date(2010, 0, 1),\r\n         dateFormat: 'yy-mm-dd',\r\n         showAnim: 'drop',\r\n         showButtonPanel: true,\r\n         changeMonth: true,\r\n         changeYear: true,\r\n         onSelect: function () { $(this).change(); },\r\n         beforeShow: (input, inst) => {\r\n            add_clear_button(input);\r\n            inst.dpDiv.css({ marginTop: '10px', marginLeft: '-220px' });\r\n         },\r\n         onChangeMonthYear:add_clear_button,\r\n         closeText: 'Done'.i18n(),\r\n         currentText: 'Today'.i18n()\r\n      };\r\n\r\n      const dpicker = dpicker_input\r\n         .datepicker(options)\r\n         .datepicker(\"setDate\", opts.date.toISOString().slice(0, 10));\r\n\r\n      $.datepicker._gotoToday = (id) => {\r\n         $(id).datepicker('setDate', new Date()).change().datepicker('hide');\r\n      };\r\n\r\n      /* use JQ-UI icon for datepicker */\r\n      dpicker .next('button') .text('')\r\n         .button({ icons: { primary: 'ui-icon-calendar' } });\r\n\r\n      dpicker_input.on('change', function () {\r\n         const yyyy_mm_dd = $(this).val();\r\n         opts.onchange && opts.onchange(yyyy_mm_dd);\r\n      });\r\n      return dpicker_input;\r\n   }\r\n\r\n\r\n   const dpicker = addDatePicker({\r\n      date: options.date || new Date(),\r\n      onchange: (yyyy_mm_dd) => {\r\n         dropdonws.update(yyyy_mm_dd);\r\n         options.changed(yyyy_mm_dd);\r\n      },\r\n      onclear: () => {\r\n         dropdonws.clear();\r\n         options.cleared();\r\n      }\r\n   });\r\n   const dropdonws = addDateDropDowns({\r\n      date: options.date, onchange: (yyyy_mm_dd) => {\r\n         dpicker.datepicker(\"setDate\", yyyy_mm_dd);\r\n         options.changed(yyyy_mm_dd);\r\n      }\r\n   });\r\n\r\n   $('<span class=\"span-in-dialog-header\">' + options.title + '</span>').insertAfter(header);\r\n\r\n   return {\r\n      clear:() => dropdonws.clear()\r\n   };\r\n}\r\n\r\nconst getScrollHeight = (without_body) => {\r\n   var bottoms = $('.ui-dialog').map((inx, d) => {\r\n      const $d = $(d);\r\n      const $w = $d.find('.webtrader-dialog');\r\n      if($w && $w.hasClass(\"ui-dialog-content\") && !$w.hasClass('ui-dialog-minimized')) {\r\n         const offset = $d.offset();\r\n         return (offset && (offset.top + $d.height())) || 0;\r\n      }\r\n      return 0;\r\n   });\r\n   if(!without_body) {\r\n      bottoms.push($('body').height());\r\n   }\r\n   return  Math.max.apply(null, bottoms);\r\n}\r\n\r\nconst fixMinimizedDialogsPosition = () => {\r\n   var footer_height = $('.addiction-warning').height();\r\n   var scroll_bottom = $(document).height() - $(window).height() - $(window).scrollTop();\r\n   $(\"#dialog-extend-fixed-container\").css(\"bottom\", Math.max(0, footer_height - scroll_bottom));\r\n}\r\n\r\n\r\nexport const init = function($parentObj) {\r\n   /* wrap jquery ui dialog('destory') to fire an event */\r\n   var original = $.fn.dialog;\r\n   $.fn.dialog = function(cmd) {\r\n      if(cmd === 'destroy') {\r\n         this.trigger('dialogdestroy');\r\n         return original.call(this, 'destroy'); // destroy and remove from dom\r\n      }\r\n      return original.apply(this, arguments);\r\n   }\r\n\r\n   $menuUL = $parentObj.find(\"ul\");\r\n\r\n   const tileObject = $menuUL.find(\".tile\");\r\n\r\n   closeAllObject = $menuUL.find(\".closeAll\");\r\n   closeAllObject.click(() => {\r\n      /* The close click is behaving weird.\r\n         Behavior - When there are charts opened, this event is able to close all charts and then\r\n         unable to hide the menu. When There are no charts, then it behaves normally */\r\n      if ($('.webtrader-dialog').length > 0) {\r\n         $('.webtrader-dialog').dialog('close');\r\n      }\r\n   });\r\n\r\n   //Attach click listener for tile menu\r\n   tileObject.click(tileDialogs);\r\n\r\n   require([\"charts/chartWindow\",\"websockets/binary_websockets\", \"navigation/menu\"], (chartWindowObj,liveapi, menu) => {\r\n      if(!tracker.is_empty()) {\r\n         tracker.reopen();\r\n         setTimeout(fixFooterPosition, 200);\r\n         return;\r\n      }\r\n      const counts = calculateChartCount();\r\n      liveapi\r\n         .cached.send({trading_times: new Date().toISOString().slice(0, 10)})\r\n         .then((markets) => {\r\n            markets = menu.extractChartableMarkets(markets);\r\n            /* return a random element of an array */\r\n            const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];\r\n            const timePeriods = ['2h', '4h', '8h', '1d'];\r\n            const chartTypes = ['candlestick', 'line', 'ohlc', 'spline']; //This is not the complete chart type list, however its good enough to randomly select one from this subset\r\n            for (let inx = 0; inx < counts.total; ++inx) {\r\n               const submarkets = rand(markets).submarkets;\r\n               const symbols = rand(submarkets).instruments;\r\n               const sym = rand(symbols);\r\n               const timePeriod = rand(timePeriods);\r\n               const chart_type = rand(chartTypes);\r\n\r\n               chartWindowObj.addNewWindow({\r\n                  instrumentCode: sym.symbol,\r\n                  instrumentName: sym.display_name,\r\n                  timePeriod: timePeriod,\r\n                  type: chart_type,\r\n                  delayAmount: sym.delay_amount\r\n               });\r\n            }\r\n            tileDialogs(); // Trigger tile action\r\n         });\r\n   });\r\n\r\n   /* automatically log the user in if we have oauth_token in local_storage */\r\n   require(['websockets/binary_websockets' ], (liveapi) => {\r\n      if(!local_storage.get('oauth')) {\r\n         return;\r\n      }\r\n      /* query string parameters can tempered.\r\n             make sure to get loginid from webapi instead */\r\n      var oauth = local_storage.get('oauth');\r\n      Promise.all(\r\n         oauth.slice(1)\r\n            .map(acc => ({ authorize: acc.token}))\r\n            .map(req => liveapi.send(req))\r\n      )\r\n         .then((results) =>\r\n            liveapi.cached.authorize()\r\n               .then((data) => {\r\n                  results.unshift(data);\r\n                  let is_jpy_account = false;\r\n                  for(let i = 0; i < results.length; ++i) {\r\n                     oauth[i].id = results[i].authorize.loginid;\r\n                     oauth[i].is_virtual = results[i].authorize.is_virtual;\r\n                     if (results[i].authorize.landing_company_name.indexOf('japan') !== -1) {\r\n                        is_jpy_account = true;\r\n                     }\r\n                  }\r\n                  local_storage.set('oauth', oauth);\r\n                  return is_jpy_account;\r\n               })\r\n         )\r\n         .then((is_jpy_account) => {\r\n            /* Japan accounts should not be allowed to login to webtrader */\r\n            if(is_jpy_account && is_jpy_account === true) {\r\n               liveapi.invalidate();\r\n               $.growl.error({message: 'Japan accounts are not supported.'.i18n(), duration: 6000 });\r\n               local_storage.remove('oauth');\r\n               local_storage.remove('oauth-login');\r\n            }\r\n         })\r\n         .catch((err) => {\r\n            //Switch to virtual account on selfexclusion error.\r\n            if(err.code===\"SelfExclusion\"){\r\n               //Login to virtual account instead.\r\n               oauth.forEach((ele, i) => {\r\n                  if(ele.id.match(/^VRTC/)){\r\n                     liveapi.switch_account(ele.id);\r\n                     return;\r\n                  }\r\n               });\r\n               return;\r\n            }\r\n            console.error(err.message);\r\n            $.growl.error({message: err.message});\r\n            //Remove token and trigger login-error event.\r\n            local_storage.remove('oauth');\r\n            $(\".login\").trigger(\"login-error\");\r\n         });\r\n   });\r\n   $(window).resize(fixFooterPosition);\r\n   $(window).scroll(fixMinimizedDialogsPosition);\r\n   return this;\r\n}\r\n\r\nexport const fixFooterPosition = (only_on_expand) => {\r\n   $('body > .footer').width($('body').width());\r\n   const scroll_height = getScrollHeight(true);\r\n   const body_height = $('body').height();\r\n   const footer_height = $('.addiction-warning').height();\r\n   const current_height = $('body > .footer').height();\r\n   const new_height = Math.max(scroll_height + footer_height + 15, body_height);\r\n   if(current_height > new_height && only_on_expand === true) {\r\n      return;\r\n   }\r\n   $('body > .footer').css(\"margin-top\", new_height - 100);\r\n}\r\n\r\n\r\n//Trigger close even on all dialogs\r\nexport const closeAll = () => closeAllObject && closeAllObject.click();\r\n\r\n\r\n/* important options: {\r\n   title:'',\r\n   resize:fn, // callabak for dialog resize event\r\n   close: fn, // callback for dialog close event\r\n   open: fn,  // callback for dialog open event\r\n   destroy: fn, // callback for dialog destroy event\r\n   refresh: fn, // callback for refresh button click\r\n   autoOpen: false,\r\n   resizable:true,\r\n   collapsable:false,\r\n   minimizable: true,\r\n   maximizable: true,\r\n   closable:true,\r\n   modal:true, // Whether to block base page and show it as blocking modal dialog\r\n   closeOnEscape:true, // Respond to ESC key event\r\n   ignoreTileAction:false, // Is this dialog going to take part in tile action\r\n   data-*: 'value' // add arbitary data-* attributes to the dialog.('data-authorized' for exmaple)\r\n}\r\nnotes:\r\n    1- get generated dialog id via createBlankWindow(...).attr('id')\r\n    2- if autoOpen == false  use createBalnkWindow(...).dialog('open') to open the dialog\r\n    2- if minWidth and minHeight are not specified the options.width and options.height will be used for minimums.\r\n */\r\nexport const createBlankWindow = function($html,options) {\r\n   $html = $($html);\r\n   const id = \"windows-dialog-\" + ++dialogCounter;\r\n   options = $.extend({\r\n      autoOpen: false,\r\n      resizable: true,\r\n      collapsable: false,\r\n      width: 350,\r\n      height: 400,\r\n      my: 'center',\r\n      at: 'center',\r\n      of: window,\r\n      title: 'Blank window'.i18n(),\r\n      hide: 'fade',\r\n      icons: {\r\n         close: 'custom-icon-close',\r\n         minimize: 'custom-icon-minimize',\r\n         maximize: 'custom-icon-maximize'\r\n      },\r\n      open: function() {\r\n         $(this).promise().done(function () {\r\n            const changePos = $(this).dialog(\"option\",\"isTrackerInitiated\");\r\n            const pos = $(this).dialog(\"option\",\"relativePosition\");\r\n            // Open chart at a relative position if it is a chart or trade type\r\n            if(!changePos && pos){\r\n               if(!$(last_dialog).parent().length){\r\n                  last_dialog = $(this);\r\n                  return;\r\n               }\r\n               const top = parseInt($(last_dialog).parent().css(\"top\"));\r\n               const left = parseInt($(last_dialog).parent().css(\"left\"));\r\n               $($(this).parent()).css(\"top\",top+5+\"px\");\r\n               $($(this).parent()).css(\"left\",left+5+\"px\");\r\n               last_dialog = $(this);\r\n            }\r\n         });\r\n      }\r\n   }, options || {});\r\n   options.minWidth = options.minWidth || options.width;\r\n   options.minHeight = options.minHeight || options.height;\r\n\r\n   if (options.resize)\r\n      options.maximize = options.minimize  = options.restore = options.resize;\r\n\r\n   const blankWindow = $html.attr(\"id\", id);\r\n   if (!options.ignoreTileAction) blankWindow.addClass('webtrader-dialog')\r\n   blankWindow.dialog(options).dialogExtend(options);\r\n\r\n\r\n   const dialog = blankWindow.dialog('widget');\r\n   /* allow dialogs to be moved though the bottom of the page */\r\n   dialog.draggable( \"option\", \"containment\", false );\r\n   dialog.draggable( \"option\", \"scroll\", true );\r\n   dialog.on('dragstop', () => {\r\n      const top = dialog.offset().top;\r\n      if(top < 0) {\r\n         dialog.animate({ top: '0px' }, 300, dialog.trigger.bind(dialog, 'animated'));\r\n      }\r\n   });\r\n\r\n   dialog.on('dragstop', fixFooterPosition);\r\n   dialog.on('drag',() => fixFooterPosition(true));\r\n   blankWindow.on('dialogextendminimize', fixFooterPosition);\r\n   dialog.on('dialogresizestop', fixFooterPosition);\r\n\r\n   if(options.destroy) { /* register for destroy event which have been patched */\r\n      blankWindow.on('dialogdestroy', options.destroy);\r\n   }\r\n\r\n   blankWindow.moveToTop = () => {\r\n      blankWindow.dialog('open');\r\n      blankWindow.dialogExtend('restore');\r\n      blankWindow.dialog('widget').effect(\"bounce\", { times: 2, distance: 15 }, 450);\r\n   };\r\n\r\n   // add an item to window menu\r\n   let li = null;\r\n   const add_to_windows_menu = () => {\r\n      const link = $(\"<a href='#'>\" + options.title + \"</a>\");\r\n      // bring window to top on click\r\n      link.click(blankWindow.moveToTop);\r\n      li = $('<li />').addClass(id + 'LI').html(link);\r\n      $menuUL.append(li);\r\n   };\r\n   if(!options.ignoreTileAction) {\r\n      add_to_windows_menu();\r\n   }\r\n\r\n   // remove item from window menu on close\r\n   blankWindow.on('dialogclose', () => {\r\n      li && li.remove();\r\n      li = null;\r\n      fixFooterPosition();\r\n   });\r\n   blankWindow.on('dialogopen',\r\n      () => !li && !options.ignoreTileAction && add_to_windows_menu()\r\n   );\r\n   blankWindow.on('dialogextendrestore', fixFooterPosition);\r\n\r\n   if (options.resize) {\r\n      options.resize.call($html[0]);\r\n   }\r\n   blankWindow.addDateToHeader = addDateToHeader;\r\n\r\n   /* set data-* attributes on created dialog */\r\n   const attributes = Object.keys(options).filter((key) =>  _.startsWith(key, 'data-') );\r\n   attributes.forEach((key) => blankWindow.attr(key, options[key]) );\r\n\r\n   /* check and add the refresh button if needed */\r\n   if(options.refresh){\r\n      const header = blankWindow.parent().find('.ui-dialog-title');\r\n      const refresh = header.append(\"<img class='reload' src='images/refresh.svg' title='reload'/>\").find(\".reload\");\r\n      refresh.on('click',options.refresh);\r\n   }\r\n\r\n   /* options: {\r\n    *    module_id: 'statement/statement'  // require js module id\r\n    *    is_unique: true/false // is this dialog instance unique or not,\r\n    *    data: { } // arbitary data object for this dialog\r\n    * } */\r\n   blankWindow.track = (options) => tracker.track(options, blankWindow);\r\n   blankWindow.fixFooterPosition = fixFooterPosition;\r\n   blankWindow.destroy = () => blankWindow.dialog('destroy').remove();\r\n   return blankWindow;\r\n}\r\n\r\n/*\r\n   Uses a jquery-ui spinner to display a list of strings.\r\n       @param: options.index       initial value of the array to show.\r\n       @param: options.list        array of string items to show\r\n       @param: options.changed     callback thats i called when menu is changed.\r\n       @param: options.width       can specify the with of selectmenu.\r\n   Note: you should add your input to dom before turning it a spinner.\r\n\r\n   Note: you can call 'update_list(...)' on the returned spinner to update the list of items:\r\n       var spinner = makeTextSpinner(input,{list:['a,'b','c'],inx:0});\r\n       spinner.update_list(['a','d','e','f']);\r\n\r\n   TODO: move this to a utility file\r\n*/\r\nexport const makeSelectmenu = function (select, options) {\r\n   options = $.extend({\r\n      list: ['empty'],\r\n      inx: 0,\r\n      changed:  () => { }\r\n   }, options);\r\n\r\n   var inx = options.inx, list = options.list;\r\n   var update_select = (list) => {\r\n      select.children().remove();\r\n      for(let i = 0; i < list.length; ++i)\r\n         $('<option/>').val(list[i]).text(list[i]).appendTo(select);\r\n   }\r\n   update_select(list);\r\n   select.val(list[inx]);\r\n\r\n   select = select.selectmenu({ width: options.width });\r\n   select.on('selectmenuchange', function () {\r\n      var val = $(this).val();\r\n      options.changed(val);\r\n   })\r\n\r\n   select.update_list = (new_list) => {\r\n      update_select(new_list);\r\n      select.val(new_list[0]);\r\n      select.selectmenu('refresh');\r\n   }\r\n   return select;\r\n};\r\n\r\nexport const event_on = (name, cb) => {\r\n   (callbacks[name] = callbacks[name] || []).push(cb);\r\n   return cb;\r\n}\r\n\r\nexport const event_off = (name, cb) => {\r\n   if(callbacks[name]) {\r\n      var index = callbacks[name].indexOf(cb);\r\n      index !== -1 && callbacks[name].splice(index, 1);\r\n   }\r\n}\r\n\r\nexport const tile = tileDialogs;\r\nexport default {\r\n   init,\r\n   tile,\r\n   closeAll,\r\n   fixFooterPosition,\r\n   createBlankWindow,\r\n   makeSelectmenu,\r\n   event_on, event_off\r\n};\r\n"]}