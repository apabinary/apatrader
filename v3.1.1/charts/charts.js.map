{"version":3,"sources":["../../../../src/charts/charts.es6"],"names":["indicator_values","JSON","parse","values","value","Highcharts","Chart","prototype","get_indicators","chart","indicators","series","length","forEach","ind","id","entry","push","name","long_display_name","options","set_indicators","onSeriesID","addIndicator","get_indicator_series","set_indicator_series","seri","get_overlay_count","overlayCount","s","index","isInstrument","indexOf","setOptions","global","useUTC","canvasToolsURL","lang","thousandsSep","initHighchartIndicators","barsTable","destroy","containerIDWithHash","timePeriod","instrumentCode","key","keyFor","unregister","generate_csv","data","filename","instrumentName","lines","dataToBeProcessTolines","flattenData","d","ret","isArray","time","utc","format","slice","join","isNumber","high","open","low","close","isObject","title","text","FractalUpdateObject","x","isBull","isBear","y","toString","newDataLines","map","ohlc","split","bars","chain","find","instrumentCdAndTp","simplesort","concat","b","growl","notice","message","i18n","Parallel","spawn","l","line","dd","added","nDl","temp","then","csv","blob","Blob","type","navigator","msSaveBlob","link","document","createElement","download","undefined","url","URL","createObjectURL","setAttribute","style","visibility","body","appendChild","click","removeChild","error","console","drawChart","onload","overlays","highcharts","removeChart","warn","delayAmount","events","load","event","showLoading","init","execute","retrieveChartDataAndRender","series_compare","catch","err","msg","replace","setTimeout","ovlay","overlay","symbol","displaySymbol","delay_amount","isFunction","isAffiliates","isHideFooter","credits","element","remove","margin","spacing","onclick","window","spacingLeft","marginLeft","marginBottom","spacingBottom","enabled","plotOptions","candlestick","shadow","afterAnimate","removeCurrentPrice","addCurrentPrice","mousewheel","hideLoading","href","xAxis","afterSetExtremes","labels","formatter","str","axis","defaultLabelFormatter","call","ordinal","scrollbar","liveRedraw","yAxis","opposite","align","rangeSelector","tooltip","crosshairs","width","color","dashStyle","enabledIndicators","exporting","triggerReflow","reflow","refresh","newTimePeriod","newChartType","chartObj","loadedMarketData","each","log","compare","marketDataObj","getSpecificMarketData","trim","extend","overlayInsCode","overlayInsName","indicator_series","mainSeries_timePeriod","mainSeries_type","onChartIndicator","update","Promise","resolve","reject","changeTitle","newTitle","setTitle"],"mappings":"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","file":"charts.js","sourcesContent":["/**\r\n * Created by arnab on 2/11/15.\r\n */\r\nimport $ from 'jquery';\r\nimport chartingRequestMap from 'charts/chartingRequestMap';\r\nimport liveapi from 'websockets/binary_websockets';\r\nimport ohlc_handler from 'websockets/ohlc_handler';\r\nimport currentPrice from 'currentPriceIndicator';\r\nimport indicators from 'charts/indicators/highcharts_custom/indicators';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport indicators_json from 'text!charts/indicators/indicators.json';\r\nimport 'highcharts-exporting';\r\nimport 'common/util';\r\nimport 'paralleljs';\r\nimport 'jquery-growl';\r\nimport $Hmw from 'common/highcharts.mousewheel';\r\nimport ins from 'instruments/instruments';\r\n\r\nconst indicator_values = _(JSON.parse(indicators_json)).values().value();\r\nHighcharts.Chart.prototype.get_indicators = function() {\r\n    const chart = this;\r\n    const indicators = [];\r\n    if (chart.series.length > 0) {\r\n        indicator_values.forEach((ind) => {\r\n            const id = ind.id;\r\n            chart.series[0][id] && chart.series[0][id].forEach((entry) => {\r\n                indicators.push({ id: id, name: ind.long_display_name, options: entry.options })\r\n            });\r\n        });\r\n    }\r\n\r\n    return indicators;\r\n}\r\n\r\nHighcharts.Chart.prototype.set_indicators = function(indicators) {\r\n    const chart = this;\r\n    if (chart.series[0]) {\r\n        indicators.forEach((ind) => {\r\n            if (ind.options.onSeriesID) { //make sure that we are using the new onSeriesID value\r\n                ind.options.onSeriesID = chart.series[0].options.id;\r\n            }\r\n            chart.series[0].addIndicator(ind.id, ind.options);\r\n        });\r\n    }\r\n}\r\n\r\nHighcharts.Chart.prototype.get_indicator_series = function() {\r\n    const chart = this;\r\n    const series = [];\r\n    if (chart.series.length > 0) {\r\n        indicator_values.forEach((ind) => {\r\n            const id = ind.id;\r\n            chart.series[0][id] && chart.series[0][id][0] && series.push({ id: id, series: chart.series[0][id] })\r\n        });\r\n    }\r\n    return series;\r\n}\r\n\r\nHighcharts.Chart.prototype.set_indicator_series = function(series) {\r\n    const chart = this;\r\n    if (chart.series.length == 0) {\r\n        return;\r\n    }\r\n    series.forEach((seri) => {\r\n        chart.series[0][seri.id] = seri.series;\r\n    });\r\n}\r\n\r\nHighcharts.Chart.prototype.get_overlay_count = function() {\r\n    let overlayCount = 0;\r\n    this.series.forEach((s, index) => {\r\n        if (s.options.isInstrument && s.options.id.indexOf('navigator') == -1 && index != 0) {\r\n            overlayCount++;\r\n        }\r\n    });\r\n    return overlayCount;\r\n}\r\n\r\n$(() => {\r\n\r\n    Highcharts.setOptions({\r\n        global: {\r\n            useUTC: true,\r\n            canvasToolsURL: \"https://code.highcharts.com/modules/canvas-tools.js\"\r\n        },\r\n        lang: { thousandsSep: ',' } /* format numbers with comma (instead of space) */\r\n    });\r\n\r\n});\r\n\r\nindicators.initHighchartIndicators(chartingRequestMap.barsTable);\r\n\r\nexport const destroy = (options) => {\r\n    const containerIDWithHash = options.containerIDWithHash,\r\n        timePeriod = options.timePeriod,\r\n        instrumentCode = options.instrumentCode;\r\n    if (!timePeriod || !instrumentCode) return;\r\n\r\n    //granularity will be 0 for tick timePeriod\r\n    const key = chartingRequestMap.keyFor(instrumentCode, timePeriod);\r\n    chartingRequestMap.unregister(key, containerIDWithHash);\r\n}\r\n\r\nexport const generate_csv = (chart, data) => {\r\n    const filename = data.instrumentName + ' (' + data.timePeriod + ')' + '.csv';\r\n\r\n    let lines = [],\r\n        dataToBeProcessTolines = [];\r\n    const flattenData = (d) => {\r\n        let ret = null;\r\n        if (_.isArray(d) && d.length > 3) {\r\n            const time = d[0];\r\n            ret = '\"' + moment.utc(time).format('YYYY-MM-DD HH:mm') + '\"' + ',' + d.slice(1, d.length).join(',');\r\n        } //OHLC case\r\n        else if (_.isNumber(d.high)) ret = '\"' + moment.utc(d.time).format('YYYY-MM-DD HH:mm') + '\"' + ',' + d.open + ',' + d.high + ',' + d.low + ',' + d.close;\r\n        else if (_.isArray(d) && d.length > 1) ret = '\"' + moment.utc(d[0]).format('YYYY-MM-DD HH:mm') + '\"' + ',' + d[1]; //Tick chart case\r\n        else if (_.isObject(d) && d.title && d.text) {\r\n            if (d instanceof FractalUpdateObject) {\r\n                ret = '\"' + moment.utc(d.x || d.time).format('YYYY-MM-DD HH:mm') + '\"' + ',' + (d.isBull ? 'UP' : d.isBear ? 'DOWN' : ' ');\r\n            } else ret = '\"' + moment.utc(d.x || d.time).format('YYYY-MM-DD HH:mm') + '\"' + ',' + (d.text);\r\n        } else if (_.isNumber(d.y)) ret = '\"' + moment.utc(d.x || d.time).format('YYYY-MM-DD HH:mm') + '\"' + ',' + (d.y || d.close);\r\n        else ret = d.toString(); //Unknown case\r\n        return ret;\r\n    };\r\n    chart.series.forEach((series, index) => {\r\n        if (series.options.id === 'navigator') return true;\r\n        const newDataLines = series.options.data.map((d) => {\r\n            return flattenData(d);\r\n        }) || [];\r\n        if (index == 0) {\r\n            const ohlc = newDataLines[0].split(',').length > 2;\r\n            if (ohlc) lines.push('Date,Time,Open,High,Low,Close');\r\n            else lines.push('Date,Time,\"' + series.options.name + '\"');\r\n            //newDataLines is incorrect - get it from lokijs\r\n            const key = chartingRequestMap.keyFor(data.instrumentCode, data.timePeriod);\r\n            const bars = chartingRequestMap.barsTable\r\n                .chain()\r\n                .find({ instrumentCdAndTp: key })\r\n                .simplesort('time', false)\r\n                .data();\r\n            lines = lines.concat(bars.map((b) => {\r\n                return ohlc ? ['\"' + moment.utc(b.time).format('YYYY-MM-DD HH:mm') + '\"', b.open, b.high, b.low, b.close].join(',') : ['\"' + moment.utc(b.time).format('YYYY-MM-DD HH:mm:ss') + '\"', b.close].join(',');\r\n            }));\r\n        } else {\r\n            lines[0] += ',\"' + series.options.name + '\"'; //Add header\r\n            dataToBeProcessTolines.push(newDataLines);\r\n        }\r\n    });\r\n\r\n    $.growl.notice({ message: 'Downloading .csv'.i18n() });\r\n    //merge here\r\n    new Parallel([lines, dataToBeProcessTolines])\r\n        .spawn((data) => {\r\n            let l = data[0];\r\n            const d = data[1];\r\n            l = l.map((line, index) => {\r\n\r\n                d.forEach((dd) => {\r\n                    let added = false;\r\n                    dd.forEach((nDl) => {\r\n                        if (nDl) {\r\n                            const temp = nDl.split(',');\r\n                            if (line.split(',')[0] === temp[0]) {\r\n                                line += ',' + temp.slice(1, temp.length).join(',');\r\n                                added = true;\r\n                                return false;\r\n                            }\r\n                        }\r\n                    });\r\n                    if (line.indexOf('Date') == -1 && !added) line += ','; //Add a gap since we did not add a value\r\n                });\r\n                if (index === 0) {\r\n                    return line;\r\n                }\r\n                return line.split(\" \").join(\"\\\",\\\"\"); //Separate date and time.\r\n            });\r\n            return l;\r\n        })\r\n        .then((data) => {\r\n            const csv = data.join('\\n'); //(is_tick ? 'Date,Tick\\n' : 'Date,Open,High,Low,Close\\n') + lines.join('\\n');\r\n            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                const link = document.createElement(\"a\");\r\n                if (link.download !== undefined) { /* Evergreen Browsers :) */\r\n                    const url = URL.createObjectURL(blob);\r\n                    link.setAttribute(\"href\", url);\r\n                    link.setAttribute(\"download\", filename);\r\n                    link.style.visibility = 'hidden';\r\n                    document.body.appendChild(link);\r\n                    link.click();\r\n                    document.body.removeChild(link);\r\n                }\r\n            }\r\n        }, (error) => {\r\n            $.growl.error({ message: 'Error downloading .csv'.i18n() });\r\n            console.error(error);\r\n        });\r\n\r\n}\r\n\r\n/**\r\n * This method is the core and the starting point of highstock charts drawing\r\n * @param containerIDWithHash\r\n * @param instrumentCode\r\n * @param instrumentName\r\n * @param timePeriod\r\n * @param type\r\n * @param onload // optional onload callback\r\n */\r\nexport const drawChart = (containerIDWithHash, options, onload) => {\r\n    let indicators = [];\r\n    let overlays = [];\r\n\r\n    if ($(containerIDWithHash).highcharts()) {\r\n        //Just making sure that everything has been cleared out before starting a new thread\r\n        const key = chartingRequestMap.keyFor(options.instrumentCode, options.timePeriod);\r\n        chartingRequestMap.removeChart(key, containerIDWithHash);\r\n        const chart = $(containerIDWithHash).highcharts();\r\n        indicators = chart.get_indicators() || [];\r\n        overlays = options.overlays || [];\r\n        chart.destroy();\r\n    }\r\n    if (options.indicators) { /* this comes only from tracker.js & ChartTemplateManager.js */\r\n        indicators = options.indicators || [];\r\n        overlays = options.overlays || [];\r\n        $(containerIDWithHash).data(\"overlayCount\", overlays.length);\r\n    }\r\n\r\n    /* ignore overlays if chart type is candlestick or ohlc */\r\n    if ((options.type === 'candlestick' || options.type === 'ohlc') && overlays.length > 0) {\r\n        /* we should not come here, logging a warning as an alert if we somehow do */\r\n        console.warn(\"Ingoring overlays because chart type is \" + options.type);\r\n        overlays = [];\r\n    }\r\n\r\n    //Save some data in DOM\r\n    $(containerIDWithHash).data({\r\n        instrumentCode: options.instrumentCode,\r\n        instrumentName: options.instrumentName,\r\n        timePeriod: options.timePeriod,\r\n        type: options.type,\r\n        delayAmount: options.delayAmount\r\n    });\r\n\r\n    // Create the chart\r\n    $(containerIDWithHash).highcharts('StockChart', {\r\n\r\n        chart: {\r\n            events: {\r\n                load: function(event) {\r\n\r\n                    this.showLoading();\r\n                    currentPrice.init();\r\n                    liveapi.execute(() => {\r\n                        ohlc_handler.retrieveChartDataAndRender({\r\n                            timePeriod: options.timePeriod,\r\n                            instrumentCode: options.instrumentCode,\r\n                            containerIDWithHash: containerIDWithHash,\r\n                            type: options.type,\r\n                            instrumentName: options.instrumentName,\r\n                            series_compare: options.series_compare,\r\n                            delayAmount: options.delayAmount\r\n                        }).catch((err) => {\r\n                            const msg = 'Error getting data for %1'.i18n().replace('%1', options.instrumentName);\r\n                            $.growl.error({ message: msg });\r\n                            const chart = $(containerIDWithHash).highcharts();\r\n                            chart && chart.showLoading(msg);\r\n                            console.error(err);\r\n                        }).then(() => {\r\n                            const chart = $(containerIDWithHash).highcharts();\r\n                            /* the data is loaded but is not applied yet, its on the js event loop,\r\n                               wait till the chart data is applied and then add the indicators */\r\n                            setTimeout(() => {\r\n                                chart && chart.set_indicators(indicators); // put back removed indicators\r\n                                overlays.forEach((ovlay) => {\r\n                                    overlay(containerIDWithHash, ovlay.symbol, ovlay.displaySymbol, ovlay.delay_amount);\r\n                                });\r\n                            }, 0);\r\n                        });\r\n                    });\r\n\r\n                    if ($.isFunction(onload)) {\r\n                        onload();\r\n                    }\r\n\r\n                    if (isAffiliates() && isHideFooter()) {\r\n                        $(this.credits.element).remove();\r\n                        this.margin[2] = 5;\r\n                        this.spacing[2] = 0;\r\n                    } else {\r\n                        this.credits.element.onclick = () => {\r\n                            window.open(\r\n                                'http://webtrader.binary.com',\r\n                                '_blank'\r\n                            );\r\n                        }\r\n                    }\r\n\r\n                }\r\n            },\r\n            spacingLeft: 0,\r\n            marginLeft: 45,\r\n            /* disable the auto size labels so the Y axes become aligned */\r\n            marginBottom: 15,\r\n            spacingBottom: 15\r\n        },\r\n\r\n        navigator: {\r\n            enabled: true,\r\n            series: {\r\n                id: 'navigator'\r\n            }\r\n        },\r\n\r\n        plotOptions: {\r\n            candlestick: {\r\n                shadow: false\r\n            },\r\n            series: {\r\n                events: {\r\n                    afterAnimate: function() {\r\n                        if (this.options.isInstrument && this.options.id !== \"navigator\") {\r\n                            //this.isDirty = true;\r\n                            //this.isDirtyData = true;\r\n\r\n                            //Add current price indicator\r\n                            //If we already added currentPriceLine for this series, ignore it\r\n                            //console.log(this.options.id, this.yAxis.plotLinesAndBands);\r\n                            this.removeCurrentPrice();\r\n                            this.addCurrentPrice();\r\n\r\n                            //Add mouse wheel zooming\r\n                            $Hmw.mousewheel(containerIDWithHash);\r\n\r\n                        }\r\n\r\n                        this.chart.hideLoading();\r\n                        //this.chart.redraw();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        title: {\r\n            text: \"\" //name to display\r\n        },\r\n\r\n        credits: {\r\n            href: 'http://webtrader.binary.com',\r\n            text: 'Binary.com : Webtrader',\r\n        },\r\n\r\n        xAxis: {\r\n            events: {\r\n                afterSetExtremes: function() {\r\n                    /*console.log('This method is called every time the zoom control is changed. TODO.' +\r\n                     'In future, I want to get more data from server if users is dragging the zoom control more.' +\r\n                     'This will help to load data on chart forever! We can warn users if they are trying to load' +\r\n                     'too much data!');*/\r\n                }\r\n            },\r\n            labels: {\r\n                formatter: function() {\r\n                    const str = this.axis.defaultLabelFormatter.call(this);\r\n                    return str.replace('.', '');\r\n                }\r\n            },\r\n            ordinal: false\r\n        },\r\n\r\n        scrollbar: {\r\n            liveRedraw: false\r\n        },\r\n\r\n        yAxis: [{\r\n            opposite: false,\r\n            labels: {\r\n                formatter: function() {\r\n                    if ($(containerIDWithHash).data(\"overlayIndicator\")) {\r\n                        return (this.value > 0 ? ' + ' : '') + this.value + '%';\r\n                    } else {\r\n                        return this.value;\r\n                    }\r\n                },\r\n                align: 'center'\r\n            }\r\n        }],\r\n\r\n        rangeSelector: {\r\n            enabled: false\r\n        },\r\n\r\n        tooltip: {\r\n            crosshairs: [{\r\n                width: 2,\r\n                color: 'red',\r\n                dashStyle: 'dash'\r\n            }, {\r\n                width: 2,\r\n                color: 'red',\r\n                dashStyle: 'dash'\r\n            }],\r\n            enabled: true,\r\n            enabledIndicators: true\r\n        },\r\n\r\n        exporting: {\r\n            enabled: false,\r\n            url: 'https://export.highcharts.com',\r\n            // Naming the File\r\n            filename: options.instrumentName.split(' ').join('_') + \"(\" + options.timePeriod + \")\"\r\n        }\r\n\r\n    });\r\n}\r\n\r\nexport const triggerReflow = (containerIDWithHash) => {\r\n    if ($(containerIDWithHash).highcharts()) {\r\n        $(containerIDWithHash).highcharts().reflow();\r\n    }\r\n}\r\n\r\nexport const refresh = function(containerIDWithHash, newTimePeriod, newChartType, indicators, overlays) {\r\n    const instrumentCode = $(containerIDWithHash).data(\"instrumentCode\");\r\n    if (newTimePeriod) {\r\n        //Unsubscribe from tickstream.\r\n        const key = chartingRequestMap.keyFor(instrumentCode, $(containerIDWithHash).data(\"timePeriod\"));\r\n        chartingRequestMap.unregister(key, containerIDWithHash);\r\n        $(containerIDWithHash).data(\"timePeriod\", newTimePeriod);\r\n    }\r\n    if (newChartType) $(containerIDWithHash).data(\"type\", newChartType);\r\n    else newChartType = $(containerIDWithHash).data(\"type\", newChartType);\r\n\r\n    //Get all series details from this chart\r\n    const chart = $(containerIDWithHash).highcharts();\r\n    const chartObj = this;\r\n    let loadedMarketData = [],\r\n        series_compare = undefined;\r\n    /* for ohlc and candlestick series_compare must NOT be percent */\r\n    if (newChartType !== 'ohlc' && newChartType !== 'candlestick') {\r\n        $(chart.series).each((index, series) => {\r\n            console.log('Refreshing : ', series.options.isInstrument, series.options.name);\r\n            if (series.options.isInstrument) {\r\n                loadedMarketData.push(series.name);\r\n                //There could be one valid series_compare value per chart\r\n                series_compare = series.options.compare;\r\n            }\r\n        });\r\n    }\r\n    if (!overlays) {\r\n        overlays = [];\r\n        loadedMarketData.forEach((value) => {\r\n            const marketDataObj = ins.getSpecificMarketData(value);\r\n            if (marketDataObj.symbol != undefined && $.trim(marketDataObj.symbol) != $(containerIDWithHash).data(\"instrumentCode\")) {\r\n                const overlay = {\r\n                    symbol: marketDataObj.symbol,\r\n                    displaySymbol: value,\r\n                    delay_amount: marketDataObj.delay_amount\r\n                };\r\n                overlays.push(overlay);\r\n            }\r\n        });\r\n    }\r\n    chartObj.drawChart(containerIDWithHash, {\r\n        instrumentCode: instrumentCode,\r\n        instrumentName: $(containerIDWithHash).data(\"instrumentName\"),\r\n        timePeriod: $(containerIDWithHash).data(\"timePeriod\"),\r\n        type: $(containerIDWithHash).data(\"type\"),\r\n        series_compare: series_compare,\r\n        delayAmount: $(containerIDWithHash).data(\"delayAmount\"),\r\n        overlays: overlays,\r\n        indicators: indicators\r\n    });\r\n\r\n}\r\n\r\nexport const addIndicator = (containerIDWithHash, options) => {\r\n    if ($(containerIDWithHash).highcharts()) {\r\n        const chart = $(containerIDWithHash).highcharts();\r\n        const series = chart.series[0];\r\n        if (series) {\r\n            chart.addIndicator($.extend({\r\n                id: series.options.id\r\n            }, options));\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Function to overlay instrument on base chart\r\n * @param containerIDWithHash\r\n * @param overlayInsCode\r\n * @param overlayInsName\r\n */\r\nexport const overlay = (containerIDWithHash, overlayInsCode, overlayInsName, delayAmount) => {\r\n    if ($(containerIDWithHash).highcharts()) {\r\n        const chart = $(containerIDWithHash).highcharts();\r\n        const indicator_series = chart.get_indicator_series();\r\n        //const mainSeries_instCode     = $(containerIDWithHash).data(\"instrumentCode\");\r\n        //const mainSeries_instName     = $(containerIDWithHash).data(\"instrumentName\");\r\n        /*\r\n            We have to first set the data to NULL and then recaculate the data and set it back\r\n            This is needed, else highstocks throws error\r\n         */\r\n        const mainSeries_timePeriod = $(containerIDWithHash).data(\"timePeriod\");\r\n        const mainSeries_type = $(containerIDWithHash).data(\"type\");\r\n        chart.showLoading();\r\n        for (let index = 0; index < chart.series.length; index++) {\r\n            //console.log('Instrument name : ' + chart.series[index].name);\r\n            const series = chart.series[index];\r\n            if (series.options.isInstrument || series.options.onChartIndicator) {\r\n                series.update({\r\n                    compare: 'percent'\r\n                });\r\n            }\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            liveapi.execute(() => {\r\n                ohlc_handler.retrieveChartDataAndRender({\r\n                    timePeriod: mainSeries_timePeriod,\r\n                    instrumentCode: overlayInsCode,\r\n                    containerIDWithHash: containerIDWithHash,\r\n                    type: mainSeries_type,\r\n                    instrumentName: overlayInsName,\r\n                    series_compare: 'percent',\r\n                    delayAmount: delayAmount\r\n                }).then(() => {\r\n                    chart && chart.set_indicator_series(indicator_series);\r\n                    resolve();\r\n                }).catch(resolve);\r\n            });\r\n        });\r\n    }\r\n    return Promise.resolve();\r\n}\r\n\r\nexport const changeTitle = (containerIDWithHash, newTitle) => {\r\n    const chart = $(containerIDWithHash).highcharts();\r\n    chart.setTitle(newTitle);\r\n}\r\n\r\nexport default {\r\n    drawChart,\r\n    destroy,\r\n    triggerReflow,\r\n    generate_csv,\r\n    refresh,\r\n    addIndicator,\r\n    overlay,\r\n    changeTitle\r\n}\r\n"]}