{"version":3,"sources":["../../../../src/charts/chartWindow.es6"],"names":["_trigger_Resize_Effects","find","width","height","trigger","containerIDWithHash","attr","triggerReflow","options_store","addNewWindow","options","options_copy","extend","title","instrumentName","relativePosition","close","id","container","timePeriod","data","instrumentCode","highcharts","destroy","dialog","remove","cleanBinding","resize","refresh","open","parent","promise","done","triggerResizeEffects","createBlankWindow","i18n","end","indicators","overlays","update_track","track","module_id","is_unique","on","e","type","chart","get_indicators","overlay","push","displaySymbol","drawChart","bind","table_view","init","show","add_chart_options","totalWindows","length","get_chart_options","dialog_id","cloneDeep","name","set_chart_options","apply_chart_options","chart_window_functions","require","charts","chartOptions","updateOptions","callerContext","call","changeChartWindowTitle","dialogId"],"mappings":"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","file":"chartWindow.js","sourcesContent":["/**\r\n * Created by arnab on 2/13/15.\r\n */\r\nimport $ from \"jquery\";\r\nimport windows from \"windows/windows\";\r\nimport $chartWindowHtml from \"text!charts/chartWindow.html\";\r\nimport _ from 'lodash';\r\nimport \"jquery.dialogextend\";\r\nimport 'common/util';\r\nimport charts from \"charts/charts\";\r\nimport chartOptions from \"charts/chartOptions\";\r\nimport tableView from \"charts/tableView\";\r\n\r\nfunction _trigger_Resize_Effects() {\r\n    $(this).find(\".chartSubContainer\").width($(this).width() - 10);\r\n    //Because of title taking space, we have to reduce height\r\n    $(this).find(\".chartSubContainer\").height($(this).height() - 55);\r\n    $(this).trigger(\"resize-event\");\r\n    const containerIDWithHash = \"#\" + $(this).find(\".chartSubContainer\").attr(\"id\");\r\n    charts.triggerReflow(containerIDWithHash);\r\n}\r\n\r\nconst options_store = {};\r\n\r\n/**\r\n * @param options\r\n * @returns {*}\r\n */\r\nexport const addNewWindow = function(options) {\r\n    const options_copy = options;\r\n    options = $.extend({\r\n        title: options.instrumentName,\r\n        relativePosition: true,\r\n        close: function() {\r\n            const id = $(this).attr('id');\r\n            const container = $(\"#\" + id + \"_chart\");\r\n            const timePeriod = container.data(\"timePeriod\");\r\n            const instrumentCode = container.data('instrumentCode');\r\n            container.highcharts().destroy();\r\n            $(this).dialog('destroy').remove(); //completely remove this dialog\r\n            charts.destroy({\r\n                containerIDWithHash: \"#\" + id + \"_chart\",\r\n                timePeriod: timePeriod,\r\n                instrumentCode: instrumentCode\r\n            });\r\n            chartOptions.cleanBinding(id);\r\n        },\r\n        resize: _trigger_Resize_Effects,\r\n        refresh: function() {\r\n            charts.refresh('#' + id + '_chart');\r\n        },\r\n        open: function() {\r\n            const dialog = $(this);\r\n            $(this).parent().promise().done(function() {\r\n                triggerResizeEffects(dialog);\r\n            });\r\n        }\r\n    }, options);\r\n    const dialog = windows.createBlankWindow($($chartWindowHtml).i18n(), options),\r\n        id = dialog.attr('id');\r\n    dialog.find('div.chartSubContainerHeader').attr('id', id + \"_header\").end()\r\n        .find('div.chartSubContainer').attr('id', id + \"_chart\").end();\r\n\r\n\r\n\r\n    /* tracking the chart, includion indicators & overlyas */\r\n    options_store[id] = options_copy;\r\n    options_store[id].indicators = options_store[id].indicators || [];\r\n    options_store[id].overlays = options_store[id].overlays || [];\r\n    const update_track = dialog.track({\r\n        module_id: 'chartWindow',\r\n        is_unique: false,\r\n        data: options_store[id]\r\n    });\r\n    dialog.on('chart-type-changed', function(e, type) {\r\n        options_store[id].type = type;\r\n        update_track(options_store[id]);\r\n    });\r\n    dialog.on('chart-time-period-changed', function(e, timePeriod) {\r\n        options_store[id].timePeriod = timePeriod;\r\n        update_track(options_store[id]);\r\n    });\r\n    dialog.on('chart-indicators-changed', function(e, chart) {\r\n        options_store[id].indicators = chart.get_indicators();\r\n        update_track(options_store[id]);\r\n    });\r\n    dialog.on('chart-overlay-add', function(e, overlay) {\r\n        options_store[id].overlays.push(overlay);\r\n        update_track(options_store[id]);\r\n    });\r\n    dialog.on('chart-overlay-remove', function(e, displaySymbol) {\r\n        _.remove(options_store[id].overlays, displaySymbol);\r\n        update_track(options_store[id]);\r\n    });\r\n    dialog.on('chart-options-changed', function(e) {\r\n        update_track(options_store[id]);\r\n    });\r\n    dialog.dialog('open');\r\n    /* initialize chartOptions & table-view once chart is rendered */\r\n    charts.drawChart(\"#\" + id + \"_chart\", options, options.resize.bind($(dialog)));\r\n    const table_view = tableView.init(dialog);\r\n    chartOptions.init(id, options.timePeriod, options.type, table_view.show, options.instrumentName, options.instrumentCode);\r\n\r\n    return dialog;\r\n}\r\n\r\n// This is for affiliates. Hope it works. Fingers crossed.\r\nexport const add_chart_options = function(id, options) {\r\n    const dialog = $(\"#\" + id);\r\n    options_store[id] = options;\r\n    options_store[id].indicators = options_store[id].indicators || [];\r\n    options_store[id].overlays = options_store[id].overlays || [];\r\n    dialog.on('chart-type-changed', function(e, type) {\r\n        options_store[id].type = type;\r\n    });\r\n    dialog.on('chart-time-period-changed', function(e, timePeriod) {\r\n        options_store[id].timePeriod = timePeriod;\r\n    });\r\n    dialog.on('chart-indicators-changed', function(e, chart) {\r\n        options_store[id].indicators = chart.get_indicators();\r\n    });\r\n    dialog.on('chart-overlay-add', function(e, overlay) {\r\n        options_store[id].overlays.push(overlay);\r\n    });\r\n    dialog.on('chart-overlay-remove', function(e, displaySymbol) {\r\n        _.remove(options_store[id].overlays, displaySymbol);\r\n    });\r\n}\r\n\r\nexport const totalWindows = function() {\r\n    return $(\"div.webtrader-dialog\").length;\r\n}\r\n\r\n/* id of dialog. WITHOUT '#' prefix or '_chart' suffix */\r\nexport const get_chart_options = function(dialog_id) {\r\n    const options = _.cloneDeep(options_store[dialog_id]);\r\n    if (!options.name) {\r\n        options.name = '';\r\n    }\r\n    return options;\r\n}\r\nexport const set_chart_options = function(dialog_id, options) {\r\n    options.instrumentCode = options_store[dialog_id].instrumentCode;\r\n    options.instrumentName = options_store[dialog_id].instrumentName;\r\n    options_store[dialog_id] = options;\r\n    $('#' + dialog_id).trigger('chart-options-changed');\r\n}\r\nexport const apply_chart_options = function(dialog_id, options) {\r\n    chart_window_functions.set_chart_options(dialog_id, options);\r\n    require(['charts/charts', 'charts/chartOptions'], function(charts, chartOptions) {\r\n        chartOptions.updateOptions( /* update the chart options settings */\r\n            dialog_id, options.type, options.timePeriod, options.indicators.length, options.overlays.length);\r\n        charts.refresh('#' + dialog_id + '_chart', options.timePeriod, options.type, options.indicators, options.overlays);\r\n    });\r\n}\r\n\r\n/**\r\n * @param callerContext - Should be the Jquery object for dialog\r\n */\r\nexport const triggerResizeEffects = function(callerContext) {\r\n    _trigger_Resize_Effects.call(callerContext);\r\n}\r\n\r\nexport const changeChartWindowTitle = function(dialogId, instrumentName, timePeriod) {\r\n    $('#' + dialogId).dialog('option', 'title', instrumentName + \" (\" + timePeriod + \")\");\r\n}\r\nconst chart_window_functions = {\r\n    addNewWindow,\r\n    add_chart_options,\r\n    totalWindows,\r\n    get_chart_options,\r\n    set_chart_options,\r\n    apply_chart_options\r\n};\r\n\r\nexport default chart_window_functions;\r\n"]}