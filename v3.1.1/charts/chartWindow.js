define(["exports","jquery","windows/windows","text!charts/chartWindow.html","lodash","charts/charts","charts/chartOptions","charts/tableView","jquery.dialogextend","common/util"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){return a&&a.__esModule?a:{"default":a}}function j(){k["default"](this).find(".chartSubContainer").width(k["default"](this).width()-10),k["default"](this).find(".chartSubContainer").height(k["default"](this).height()-55),k["default"](this).trigger("resize-event");var a="#"+k["default"](this).find(".chartSubContainer").attr("id");o["default"].triggerReflow(a)}Object.defineProperty(a,"__esModule",{value:!0}),a.changeChartWindowTitle=a.triggerResizeEffects=a.apply_chart_options=a.set_chart_options=a.get_chart_options=a.totalWindows=a.add_chart_options=a.addNewWindow=void 0;var k=i(b),l=i(c),m=i(d),n=i(e),o=i(f),p=i(g),q=i(h),r={},s=a.addNewWindow=function(a){var b=a;a=k["default"].extend({title:a.instrumentName,relativePosition:!0,close:function(){var a=k["default"](this).attr("id"),b=k["default"]("#"+a+"_chart"),c=b.data("timePeriod"),d=b.data("instrumentCode");b.highcharts().destroy(),k["default"](this).dialog("destroy").remove(),o["default"].destroy({containerIDWithHash:"#"+a+"_chart",timePeriod:c,instrumentCode:d}),p["default"].cleanBinding(a)},resize:j,refresh:function(){o["default"].refresh("#"+d+"_chart")},open:function(){var a=k["default"](this);k["default"](this).parent().promise().done(function(){y(a)})}},a);var c=l["default"].createBlankWindow(k["default"](m["default"]).i18n(),a),d=c.attr("id");c.find("div.chartSubContainerHeader").attr("id",d+"_header").end().find("div.chartSubContainer").attr("id",d+"_chart").end(),r[d]=b,r[d].indicators=r[d].indicators||[],r[d].overlays=r[d].overlays||[];var e=c.track({module_id:"chartWindow",is_unique:!1,data:r[d]});c.on("chart-type-changed",function(a,b){r[d].type=b,e(r[d])}),c.on("chart-time-period-changed",function(a,b){r[d].timePeriod=b,e(r[d])}),c.on("chart-indicators-changed",function(a,b){r[d].indicators=b.get_indicators(),e(r[d])}),c.on("chart-overlay-add",function(a,b){r[d].overlays.push(b),e(r[d])}),c.on("chart-overlay-remove",function(a,b){n["default"].remove(r[d].overlays,b),e(r[d])}),c.on("chart-options-changed",function(){e(r[d])}),c.dialog("open"),o["default"].drawChart("#"+d+"_chart",a,a.resize.bind(k["default"](c)));var f=q["default"].init(c);return p["default"].init(d,a.timePeriod,a.type,f.show,a.instrumentName,a.instrumentCode),c},t=a.add_chart_options=function(a,b){var c=k["default"]("#"+a);r[a]=b,r[a].indicators=r[a].indicators||[],r[a].overlays=r[a].overlays||[],c.on("chart-type-changed",function(b,c){r[a].type=c}),c.on("chart-time-period-changed",function(b,c){r[a].timePeriod=c}),c.on("chart-indicators-changed",function(b,c){r[a].indicators=c.get_indicators()}),c.on("chart-overlay-add",function(b,c){r[a].overlays.push(c)}),c.on("chart-overlay-remove",function(b,c){n["default"].remove(r[a].overlays,c)})},u=a.totalWindows=function(){return k["default"]("div.webtrader-dialog").length},v=a.get_chart_options=function(a){var b=n["default"].cloneDeep(r[a]);return b.name||(b.name=""),b},w=a.set_chart_options=function(a,b){b.instrumentCode=r[a].instrumentCode,b.instrumentName=r[a].instrumentName,r[a]=b,k["default"]("#"+a).trigger("chart-options-changed")},x=a.apply_chart_options=function(a,b){z.set_chart_options(a,b),require(["charts/charts","charts/chartOptions"],function(c,d){d.updateOptions(a,b.type,b.timePeriod,b.indicators.length,b.overlays.length),c.refresh("#"+a+"_chart",b.timePeriod,b.type,b.indicators,b.overlays)})},y=a.triggerResizeEffects=function(a){j.call(a)},z=(a.changeChartWindowTitle=function(a,b,c){k["default"]("#"+a).dialog("option","title",b+" ("+c+")")},{addNewWindow:s,add_chart_options:t,totalWindows:u,get_chart_options:v,set_chart_options:w,apply_chart_options:x});a["default"]=z});