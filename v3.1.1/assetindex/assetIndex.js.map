{"version":3,"sources":["../../../../src/assetindex/assetIndex.es6"],"names":["table","assetWin","init","li","click","createBlankWindow","title","i18n","width","height","track","module_id","is_unique","data","dialog","require","initAssetWin","moveToTop","processMarketSubmarkets","markets","extractChartableMarkets","ret","forEach","market","smarkets","display_name","submarkets","smarket","instruments","map","symbol","refreshTable","assets","updateTable","market_name","submarket_name","symbols","rows","filter","asset","indexOf","props","prop","unshift","api","remove","add","draw","processing_msg","attr","show","Promise","all","cached","send","trading_times","Date","toISOString","slice","asset_index","then","results","header","parent","find","addClass","dialog_buttons","market_names","makeSelectmenu","insertBefore","list","Object","keys","inx","changed","val","submarket_names","update_list","selectmenu","is_rtl_language","local_storage","get","value","hide","err","console","error","catch","growl","message","$html","appendTo","dataTable","className","paging","ordering","searching","processing","column","every","on","search"],"mappings":"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","file":"assetIndex.js","sourcesContent":["ï»¿/**\r\n * Created by amin on October 19, 2015.\r\n */\r\nimport $ from 'jquery';\r\nimport windows from '../windows/windows';\r\nimport liveapi from '../websockets/binary_websockets';\r\nimport menu from \"../navigation/menu\";\r\nimport _ from \"lodash\";\r\nimport \"datatables\";\r\nimport \"jquery-growl\";\r\n\r\nlet table = null;\r\nlet assetWin = null;\r\n\r\nexport const init = (li) => {\r\n    li.click(() => {\r\n        if (!assetWin) {\r\n            assetWin = windows.createBlankWindow($('<div/>'), {\r\n                title: 'Asset Index'.i18n(),\r\n                width: 700,\r\n                height: 400\r\n            });\r\n            assetWin.track({\r\n                module_id: 'assetIndex',\r\n                is_unique: true,\r\n                data: null\r\n            });\r\n            assetWin.dialog('open'); /* bring window to front */\r\n            require(['text!assetindex/assetIndex.html'], initAssetWin);\r\n        } else\r\n            assetWin.moveToTop();\r\n    });\r\n}\r\n\r\nconst processMarketSubmarkets = (markets) => {\r\n    markets = menu.extractChartableMarkets(markets);\r\n\r\n    const ret = {};\r\n    markets.forEach((market) => {\r\n        const smarkets = ret[market.display_name] = {};\r\n        market.submarkets.forEach((smarket) => {\r\n            smarkets[smarket.display_name] = smarket.instruments.map((symbol) => {\r\n                return symbol.display_name; });\r\n        });\r\n    });\r\n    return ret;\r\n}\r\n\r\nconst refreshTable = () => {\r\n    let assets = [];\r\n    let markets = {};\r\n    const updateTable = (market_name, submarket_name) => {\r\n        const symbols = markets[market_name][submarket_name];\r\n        const rows = assets\r\n            .filter((asset) => {\r\n                return symbols.indexOf(asset[1] /* asset.name */ ) > -1;\r\n            })\r\n            .map((asset) => {\r\n                /* secham:\r\n                    [ \"frxAUDJPY\",\"AUD/JPY\",\r\n                        [\"callput\",\"callput\",\"5t\",\"365d\"],\r\n                        [\"touchnotouch\",\"Touch/No Touch\",\"1h\",\"1h\"],\r\n                        [\"endsinout\",\"endsinout\",\"1d\",\"1d\"],\r\n                        [\"staysinout\",\"staysinout\",\"1d\",\"1d\"]\r\n                    ]\r\n                */\r\n                const props = asset[2] /* asset.props */\r\n                    .map((prop) => {\r\n                        return prop[2] + ' - ' + prop[3]; }); /* for each property extract a string */\r\n                props.unshift(asset[1]); /* add asset.name to the beginning of array */\r\n\r\n                return props;\r\n            });\r\n        table.api().rows().remove();\r\n        table.api().rows.add(rows);\r\n        table.api().draw();\r\n    }\r\n\r\n    const processing_msg = $('#' + table.attr('id') + '_processing').show();\r\n    Promise.all(\r\n            [\r\n                liveapi.cached.send({ trading_times: new Date().toISOString().slice(0, 10) }),\r\n                liveapi.cached.send({ asset_index: 1 })\r\n            ])\r\n        .then((results) => {\r\n            try {\r\n                assets = results[1].asset_index;\r\n                markets = processMarketSubmarkets(results[0]);\r\n                const header = assetWin.parent().find('.ui-dialog-title').addClass('with-content');\r\n                const dialog_buttons = assetWin.parent().find('.ui-dialog-titlebar-buttonpane');\r\n\r\n                const market_names = windows\r\n                    .makeSelectmenu($('<select />').insertBefore(dialog_buttons), {\r\n                        list: Object.keys(markets), //Keys are the display_name\r\n                        inx: 1, //Index to select the item in drop down\r\n                        changed: (val) => {\r\n                            const list = Object.keys(markets[val]); /* get list of sub_markets */\r\n                            submarket_names.update_list(list);\r\n                            updateTable(market_names.val(), submarket_names.val());\r\n                        },\r\n                        width: '180px'\r\n                    });\r\n                market_names.selectmenu('widget').addClass('asset-index-selectmenu');\r\n\r\n                const is_rtl_language = local_storage.get('i18n') && local_storage.get('i18n').value === 'ar';\r\n                const submarket_names = windows\r\n                    .makeSelectmenu($('<select />').insertBefore(is_rtl_language ? market_names : dialog_buttons), {\r\n                        list: Object.keys(markets[market_names.val()]),\r\n                        inx: 0,\r\n                        changed: (val) => {\r\n                            updateTable(market_names.val(), submarket_names.val());\r\n                        },\r\n                        width: '200px'\r\n                    });\r\n                submarket_names.selectmenu('widget').addClass('asset-index-selectmenu');\r\n\r\n                updateTable(market_names.val(), submarket_names.val());\r\n                processing_msg.hide();\r\n            } catch (err) { console.error(err) }\r\n        })\r\n        .catch((error) => {\r\n            $.growl.error({ message: error.message });\r\n            console.error(error);\r\n        });\r\n}\r\n\r\nconst initAssetWin = ($html) => {\r\n    $html = $($html).i18n();\r\n    table = $html.filter('table');\r\n    $html.appendTo(assetWin);\r\n\r\n    table = table.dataTable({\r\n        data: [],\r\n        \"columnDefs\": [\r\n            { className: \"dt-body-center dt-header-center\", \"targets\": [0, 1, 2, 3, 4] },\r\n            { \"defaultContent\": \"-\", \"targets\": [0, 1, 2, 3, 4] }\r\n        ],\r\n        paging: false,\r\n        ordering: false,\r\n        searching: true,\r\n        processing: true\r\n    });\r\n    table.parent().addClass('hide-search-input');\r\n\r\n    // Apply the a search on each column input change\r\n    table.api().column(0).every(function() {\r\n        const column = this;\r\n        $('input', this.header()).on('keyup change', function() {\r\n            if (column.search() !== this.value)\r\n                column.search(this.value).draw();\r\n        });\r\n    });\r\n\r\n    refreshTable();\r\n}\r\n\r\nexport default {\r\n    init\r\n}\r\n"]}